<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TobiList Admin Panel</title>
    <meta name="robots" content="noindex, nofollow">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #07090f;
            --bg2: #0d1117;
            --bg3: #111827;
            --card: #161d2b;
            --card2: #1c2537;
            --border: rgba(255,255,255,0.07);
            --border2: rgba(255,255,255,0.12);
            --text: #e2e8f0;
            --text2: #8892a4;
            --text3: #4b5563;
            --accent: #ff3366;
            --accent2: #00d4ff;
            --accent3: #7c3aed;
            --green: #10b981;
            --yellow: #f59e0b;
            --red: #ef4444;
            --sidebar-w: 260px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'DM Sans', sans-serif;
            min-height: 100vh;
            display: flex;
        }

        /* ===== LOGIN SCREEN ===== */
        #loginScreen {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg);
        }

        #loginScreen::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(255,51,102,0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(124,58,237,0.12) 0%, transparent 50%);
            pointer-events: none;
        }

        .login-box {
            position: relative;
            z-index: 1;
            background: var(--card);
            border: 1px solid var(--border2);
            border-radius: 20px;
            padding: 2.5rem;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 40px 100px rgba(0,0,0,0.6);
        }

        .login-logo {
            font-family: 'Bebas Neue', cursive;
            font-size: 2rem;
            letter-spacing: 4px;
            background: linear-gradient(135deg, #ff3366, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: block;
            margin-bottom: 0.3rem;
        }

        .login-subtitle {
            color: var(--text2);
            font-size: 0.85rem;
            margin-bottom: 2rem;
        }

        .login-subtitle span {
            background: rgba(255,51,102,0.15);
            color: var(--accent);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.78rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .login-field { margin-bottom: 1rem; }
        .login-field label { display: block; font-size: 0.82rem; color: var(--text2); margin-bottom: 0.4rem; font-weight: 600; }
        .login-field input {
            width: 100%;
            padding: 0.85rem 1rem;
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--border2);
            border-radius: 10px;
            color: var(--text);
            font-size: 0.9rem;
            font-family: 'DM Sans', sans-serif;
            outline: none;
            transition: all 0.25s;
        }
        .login-field input:focus {
            border-color: var(--accent);
            background: rgba(255,51,102,0.05);
            box-shadow: 0 0 0 3px rgba(255,51,102,0.1);
        }

        .login-error {
            background: rgba(239,68,68,0.1);
            border: 1px solid rgba(239,68,68,0.3);
            color: var(--red);
            padding: 0.6rem 0.9rem;
            border-radius: 8px;
            font-size: 0.83rem;
            margin-bottom: 1rem;
            display: none;
        }

        .login-btn {
            width: 100%;
            padding: 0.9rem;
            background: linear-gradient(135deg, var(--accent), #ff5580);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 0.95rem;
            font-weight: 700;
            font-family: 'DM Sans', sans-serif;
            cursor: pointer;
            transition: all 0.25s;
            box-shadow: 0 4px 20px rgba(255,51,102,0.3);
        }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(255,51,102,0.45); }
        .login-btn:disabled { opacity: 0.7; transform: none; cursor: not-allowed; }

        /* ===== SIDEBAR ===== */
        #sidebar {
            width: var(--sidebar-w);
            min-height: 100vh;
            background: var(--bg2);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0; top: 0; bottom: 0;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-logo {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-logo-text {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.4rem;
            letter-spacing: 3px;
            background: linear-gradient(135deg, #ff3366, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-logo-sub {
            font-size: 0.7rem;
            color: var(--text3);
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: 2px;
        }

        .sidebar-section-label {
            padding: 1rem 1.5rem 0.4rem;
            font-size: 0.68rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--text3);
            text-transform: uppercase;
        }

        .sidebar-nav { flex: 1; overflow-y: auto; padding: 0.5rem 0; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            color: var(--text2);
            font-size: 0.88rem;
            font-weight: 500;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            margin: 0.1rem 0;
        }

        .nav-item:hover { background: rgba(255,255,255,0.04); color: var(--text); }
        .nav-item.active { background: rgba(255,51,102,0.08); color: var(--accent); border-left-color: var(--accent); }
        .nav-item .nav-icon { font-size: 1.1rem; width: 22px; text-align: center; }

        .nav-item .nav-badge {
            margin-left: auto;
            background: var(--accent);
            color: white;
            font-size: 0.68rem;
            font-weight: 700;
            padding: 2px 7px;
            border-radius: 20px;
        }

        .sidebar-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            margin-bottom: 0.8rem;
        }

        .admin-avatar {
            width: 36px; height: 36px;
            background: linear-gradient(135deg, var(--accent), var(--accent3));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .admin-name { font-size: 0.85rem; font-weight: 600; }
        .admin-role { font-size: 0.72rem; color: var(--accent); }

        .logout-btn {
            width: 100%;
            padding: 0.5rem;
            background: rgba(239,68,68,0.08);
            border: 1px solid rgba(239,68,68,0.2);
            border-radius: 8px;
            color: var(--red);
            font-size: 0.82rem;
            font-weight: 600;
            cursor: pointer;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
        }
        .logout-btn:hover { background: rgba(239,68,68,0.15); }

        /* ===== MAIN CONTENT ===== */
        #mainContent {
            margin-left: var(--sidebar-w);
            flex: 1;
            min-height: 100vh;
            display: none;
        }

        .top-bar {
            background: var(--bg2);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .page-title-bar h1 { font-size: 1.3rem; font-weight: 700; }
        .page-title-bar p { font-size: 0.82rem; color: var(--text2); margin-top: 2px; }

        .top-bar-actions { display: flex; align-items: center; gap: 1rem; }

        .live-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(16,185,129,0.1);
            border: 1px solid rgba(16,185,129,0.25);
            padding: 0.35rem 0.8rem;
            border-radius: 20px;
            font-size: 0.78rem;
            color: var(--green);
            font-weight: 600;
        }

        .live-dot {
            width: 7px; height: 7px;
            background: var(--green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }

        .refresh-btn {
            padding: 0.45rem 1rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border2);
            border-radius: 8px;
            color: var(--text2);
            font-size: 0.82rem;
            font-family: 'DM Sans', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
        }
        .refresh-btn:hover { background: rgba(255,255,255,0.08); color: var(--text); }

        /* ===== PAGE CONTENT ===== */
        .page-content {
            padding: 2rem;
            display: none;
        }
        .page-content.active { display: block; }

        /* ===== STAT CARDS ===== */
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1.4rem;
            position: relative;
            overflow: hidden;
            transition: all 0.25s;
        }
        .stat-card:hover { border-color: var(--border2); transform: translateY(-2px); }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; right: 0;
            width: 80px; height: 80px;
            border-radius: 50%;
            opacity: 0.08;
            transform: translate(20px, -20px);
        }

        .stat-card.blue::before { background: var(--accent2); }
        .stat-card.pink::before { background: var(--accent); }
        .stat-card.purple::before { background: var(--accent3); }
        .stat-card.green::before { background: var(--green); }
        .stat-card.yellow::before { background: var(--yellow); }

        .stat-icon { font-size: 1.5rem; margin-bottom: 0.8rem; }
        .stat-label { font-size: 0.78rem; color: var(--text2); font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase; margin-bottom: 0.3rem; }
        .stat-value { font-size: 2rem; font-weight: 900; line-height: 1; margin-bottom: 0.4rem; }
        .stat-card.blue .stat-value { color: var(--accent2); }
        .stat-card.pink .stat-value { color: var(--accent); }
        .stat-card.purple .stat-value { color: var(--accent3); }
        .stat-card.green .stat-value { color: var(--green); }
        .stat-card.yellow .stat-value { color: var(--yellow); }

        .stat-change {
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        .stat-change.up { color: var(--green); }
        .stat-change.down { color: var(--red); }

        /* ===== CHARTS ===== */
        .chart-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1.5rem;
        }

        .chart-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }

        .chart-card-header h3 { font-size: 1rem; font-weight: 700; }
        .chart-card-header p { font-size: 0.78rem; color: var(--text2); margin-top: 2px; }

        .chart-period-tabs { display: flex; gap: 0.3rem; }
        .period-tab {
            padding: 0.3rem 0.7rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            color: var(--text2);
            background: transparent;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
        }
        .period-tab.active { background: var(--accent); border-color: var(--accent); color: white; }

        /* ===== TABLES ===== */
        .table-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .table-header {
            padding: 1.2rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .table-header h3 { font-size: 1rem; font-weight: 700; }

        .table-actions { display: flex; gap: 0.5rem; align-items: center; }

        .search-input {
            padding: 0.4rem 0.8rem;
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.82rem;
            font-family: 'DM Sans', sans-serif;
            outline: none;
            width: 200px;
            transition: all 0.2s;
        }
        .search-input:focus { border-color: var(--accent); width: 250px; }
        .search-input::placeholder { color: var(--text3); }

        .table-action-btn {
            padding: 0.4rem 0.8rem;
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text2);
            font-size: 0.8rem;
            cursor: pointer;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
        }
        .table-action-btn:hover { background: rgba(255,255,255,0.08); color: var(--text); }
        .table-action-btn.danger:hover { background: rgba(239,68,68,0.1); color: var(--red); border-color: rgba(239,68,68,0.3); }

        table { width: 100%; border-collapse: collapse; }
        th {
            padding: 0.75rem 1.5rem;
            text-align: left;
            font-size: 0.72rem;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text3);
            background: rgba(255,255,255,0.02);
            border-bottom: 1px solid var(--border);
        }
        td {
            padding: 1rem 1.5rem;
            font-size: 0.87rem;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: rgba(255,255,255,0.02); }

        .user-cell { display: flex; align-items: center; gap: 0.7rem; }
        .user-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--accent3)); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; }
        .user-name { font-weight: 600; font-size: 0.87rem; }
        .user-email { font-size: 0.75rem; color: var(--text2); }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 3px 9px;
            border-radius: 20px;
            font-size: 0.72rem;
            font-weight: 700;
        }
        .badge-green { background: rgba(16,185,129,0.12); color: var(--green); border: 1px solid rgba(16,185,129,0.25); }
        .badge-red { background: rgba(239,68,68,0.12); color: var(--red); border: 1px solid rgba(239,68,68,0.25); }
        .badge-blue { background: rgba(0,212,255,0.12); color: var(--accent2); border: 1px solid rgba(0,212,255,0.25); }
        .badge-yellow { background: rgba(245,158,11,0.12); color: var(--yellow); border: 1px solid rgba(245,158,11,0.25); }
        .badge-purple { background: rgba(124,58,237,0.12); color: #a78bfa; border: 1px solid rgba(124,58,237,0.25); }

        .action-btns { display: flex; gap: 0.4rem; }
        .action-btn {
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            font-family: 'DM Sans', sans-serif;
            font-weight: 600;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .action-btn-view { background: rgba(0,212,255,0.1); color: var(--accent2); border-color: rgba(0,212,255,0.2); }
        .action-btn-view:hover { background: rgba(0,212,255,0.2); }
        .action-btn-ban { background: rgba(239,68,68,0.1); color: var(--red); border-color: rgba(239,68,68,0.2); }
        .action-btn-ban:hover { background: rgba(239,68,68,0.2); }
        .action-btn-unban { background: rgba(16,185,129,0.1); color: var(--green); border-color: rgba(16,185,129,0.2); }
        .action-btn-unban:hover { background: rgba(16,185,129,0.2); }
        .action-btn-delete { background: rgba(239,68,68,0.05); color: var(--red); border-color: rgba(239,68,68,0.15); }
        .action-btn-delete:hover { background: rgba(239,68,68,0.15); }

        /* ===== PAGINATION ===== */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
        }
        .pagination-info { font-size: 0.8rem; color: var(--text2); }
        .pagination-btns { display: flex; gap: 0.4rem; }
        .page-btn {
            width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 6px;
            border: 1px solid var(--border);
            cursor: pointer;
            font-size: 0.82rem;
            color: var(--text2);
            background: transparent;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
        }
        .page-btn:hover, .page-btn.active { background: var(--accent); border-color: var(--accent); color: white; }
        .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        /* ===== ANNOUNCEMENT FORM ===== */
        .form-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-card h3 { font-size: 1rem; font-weight: 700; margin-bottom: 1.2rem; }

        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--text2); margin-bottom: 0.4rem; }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--border2);
            border-radius: 10px;
            color: var(--text);
            font-size: 0.88rem;
            font-family: 'DM Sans', sans-serif;
            outline: none;
            transition: all 0.25s;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--accent);
            background: rgba(255,51,102,0.04);
            box-shadow: 0 0 0 3px rgba(255,51,102,0.1);
        }
        .form-textarea { resize: vertical; min-height: 100px; }
        .form-select option { background: var(--bg3); }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

        .submit-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--accent), #ff5580);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 0.88rem;
            font-weight: 700;
            font-family: 'DM Sans', sans-serif;
            cursor: pointer;
            transition: all 0.25s;
            box-shadow: 0 4px 20px rgba(255,51,102,0.25);
        }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(255,51,102,0.4); }

        /* ===== SETTINGS ===== */
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .settings-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1.5rem;
        }

        .settings-card h3 { font-size: 1rem; font-weight: 700; margin-bottom: 1.2rem; padding-bottom: 0.8rem; border-bottom: 1px solid var(--border); }

        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--border);
        }
        .toggle-row:last-child { border-bottom: none; }
        .toggle-label { font-size: 0.87rem; }
        .toggle-desc { font-size: 0.75rem; color: var(--text2); margin-top: 2px; }

        .toggle {
            width: 42px; height: 22px;
            background: var(--bg3);
            border: 1px solid var(--border2);
            border-radius: 11px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        .toggle::after {
            content: '';
            position: absolute;
            width: 16px; height: 16px;
            background: var(--text2);
            border-radius: 50%;
            top: 2px; left: 2px;
            transition: all 0.3s;
        }
        .toggle.on { background: rgba(16,185,129,0.2); border-color: rgba(16,185,129,0.4); }
        .toggle.on::after { background: var(--green); left: 22px; }

        /* ===== ACTIVITY LOG ===== */
        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }
        .activity-item:last-child { border-bottom: none; }

        .activity-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            margin-top: 6px;
            flex-shrink: 0;
        }

        .activity-text { font-size: 0.87rem; line-height: 1.5; }
        .activity-time { font-size: 0.75rem; color: var(--text2); margin-top: 2px; }

        /* ===== MODAL ===== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
            z-index: 9000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-overlay.open { display: flex; }

        .modal-box {
            background: var(--card);
            border: 1px solid var(--border2);
            border-radius: 16px;
            padding: 2rem;
            width: 100%;
            max-width: 480px;
            box-shadow: 0 40px 100px rgba(0,0,0,0.5);
        }

        .modal-box h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: 1.2rem; }

        .modal-actions { display: flex; gap: 0.7rem; justify-content: flex-end; margin-top: 1.5rem; }

        .btn-cancel {
            padding: 0.65rem 1.2rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border2);
            border-radius: 8px;
            color: var(--text2);
            font-size: 0.85rem;
            font-family: 'DM Sans', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-cancel:hover { background: rgba(255,255,255,0.08); }

        .btn-danger {
            padding: 0.65rem 1.2rem;
            background: rgba(239,68,68,0.15);
            border: 1px solid rgba(239,68,68,0.3);
            border-radius: 8px;
            color: var(--red);
            font-size: 0.85rem;
            font-weight: 700;
            font-family: 'DM Sans', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-danger:hover { background: rgba(239,68,68,0.25); }

        /* ===== LOADING ===== */
        .loading-row td { text-align: center; padding: 3rem; color: var(--text2); font-size: 0.9rem; }

        .spinner {
            display: inline-block;
            width: 18px; height: 18px;
            border: 2px solid rgba(255,255,255,0.1);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            vertical-align: middle;
            margin-right: 0.5rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ===== TOAST ===== */
        #toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 99999;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast-item {
            background: var(--card2);
            border: 1px solid var(--border2);
            border-radius: 10px;
            padding: 0.8rem 1.2rem;
            font-size: 0.87rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            animation: slideIn 0.3s ease;
            min-width: 240px;
        }
        .toast-item.success { border-left: 3px solid var(--green); }
        .toast-item.error { border-left: 3px solid var(--red); }
        .toast-item.info { border-left: 3px solid var(--accent2); }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .chart-grid { grid-template-columns: 1fr; }
            .settings-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            #sidebar { transform: translateX(-100%); }
            #sidebar.open { transform: translateX(0); }
            #mainContent { margin-left: 0; }
            .form-row { grid-template-columns: 1fr; }
            .stat-grid { grid-template-columns: 1fr 1fr; }
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text2);
        }
        .empty-state .empty-icon { font-size: 3rem; margin-bottom: 1rem; }
        .empty-state h3 { font-size: 1.1rem; color: var(--text); margin-bottom: 0.5rem; }
        .empty-state p { font-size: 0.87rem; }

        /* ===== SECTION HEADERS ===== */
        .section-hd {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        .section-hd h2 { font-size: 1.3rem; font-weight: 700; }
        .section-hd p { font-size: 0.82rem; color: var(--text2); margin-top: 2px; }

        /* ===== MONO TEXT ===== */
        .mono { font-family: 'JetBrains Mono', monospace; font-size: 0.82rem; }

        .gradient-text {
            background: linear-gradient(135deg, #ff3366, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body>

<!-- ===== LOGIN SCREEN ===== -->
<div id="loginScreen">
    <div class="login-box">
        <span class="login-logo">ü™Å TobiList</span>
        <p class="login-subtitle">Admin Panel ‚Äî <span>RESTRICTED</span></p>
        <div class="login-field">
            <label>E-posta</label>
            <input type="email" id="adminEmail" placeholder="admin@tobilist.com" autocomplete="email">
        </div>
        <div class="login-field">
            <label>≈ûifre</label>
            <input type="password" id="adminPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" onkeydown="if(event.key==='Enter') adminLogin()">
        </div>
        <div id="loginError" class="login-error"></div>
        <button class="login-btn" id="loginBtn" onclick="adminLogin()">Admin Giri≈üi ‚Üí</button>
    </div>
</div>

<!-- ===== SIDEBAR ===== -->
<nav id="sidebar">
    <div class="sidebar-logo">
        <div class="sidebar-logo-text">ü™Å TobiList</div>
        <div class="sidebar-logo-sub">Admin Dashboard</div>
    </div>

    <div class="sidebar-nav">
        <div class="sidebar-section-label">Genel Bakƒ±≈ü</div>
        <div class="nav-item active" onclick="showPage('dashboard')">
            <span class="nav-icon">üìä</span> Dashboard
        </div>
        <div class="nav-item" onclick="showPage('analytics')">
            <span class="nav-icon">üìà</span> Analitik
        </div>

        <div class="sidebar-section-label">Kullanƒ±cƒ±lar</div>
        <div class="nav-item" onclick="showPage('users')">
            <span class="nav-icon">üë•</span> Kullanƒ±cƒ± Listesi
            <span class="nav-badge" id="newUsersBadge">0</span>
        </div>
        <div class="nav-item" onclick="showPage('bans')">
            <span class="nav-icon">üö´</span> Yasaklƒ±lar
        </div>

        <div class="sidebar-section-label">ƒ∞√ßerik</div>
        <div class="nav-item" onclick="showPage('content')">
            <span class="nav-icon">üé¨</span> ƒ∞√ßerik Listesi
        </div>
        <div class="nav-item" onclick="showPage('announcements')">
            <span class="nav-icon">üì¢</span> Duyurular
        </div>

        <div class="sidebar-section-label">Sistem</div>
        <div class="nav-item" onclick="showPage('logs')">
            <span class="nav-icon">üìã</span> Aktivite Logu
        </div>
        <div class="nav-item" onclick="showPage('settings')">
            <span class="nav-icon">‚öôÔ∏è</span> Site Ayarlarƒ±
        </div>
    </div>

    <div class="sidebar-footer">
        <div class="admin-info">
            <div class="admin-avatar">üëë</div>
            <div>
                <div class="admin-name" id="adminNameDisplay">Admin</div>
                <div class="admin-role">S√ºper Admin</div>
            </div>
        </div>
        <button class="logout-btn" onclick="adminLogout()">üö™ √áƒ±kƒ±≈ü Yap</button>
    </div>
</nav>

<!-- ===== MAIN CONTENT ===== -->
<div id="mainContent">
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="page-title-bar">
            <h1 id="pageTitle">Dashboard</h1>
            <p id="pageSubtitle">TobiList genel istatistikleri</p>
        </div>
        <div class="top-bar-actions">
            <div class="live-badge">
                <div class="live-dot"></div>
                <span>Canlƒ±</span>
            </div>
            <button class="refresh-btn" onclick="refreshCurrentPage()">üîÑ Yenile</button>
            <span id="lastUpdated" style="font-size:0.75rem;color:var(--text3);"></span>
        </div>
    </div>

    <!-- ===== DASHBOARD PAGE ===== -->
    <div class="page-content active" id="page-dashboard">
        <div class="stat-grid">
            <div class="stat-card blue">
                <div class="stat-icon">üë•</div>
                <div class="stat-label">Toplam Kullanƒ±cƒ±</div>
                <div class="stat-value" id="statTotalUsers">‚Äî</div>
                <div class="stat-change up" id="statUsersChange">‚¨Ü Y√ºkleniyor...</div>
            </div>
            <div class="stat-card green">
                <div class="stat-icon">üü¢</div>
                <div class="stat-label">Son 7 G√ºn Aktif</div>
                <div class="stat-value" id="statActiveUsers">‚Äî</div>
                <div class="stat-change up" id="statActiveChange">‚¨Ü Y√ºkleniyor...</div>
            </div>
            <div class="stat-card pink">
                <div class="stat-icon">üé¨</div>
                <div class="stat-label">Toplam ƒ∞√ßerik</div>
                <div class="stat-value" id="statTotalContent">‚Äî</div>
                <div class="stat-change up">‚¨Ü Kullanƒ±cƒ± eklemeleri</div>
            </div>
            <div class="stat-card purple">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-label">Daƒüƒ±tƒ±lan XP</div>
                <div class="stat-value" id="statTotalXP">‚Äî</div>
                <div class="stat-change up">‚¨Ü Toplamda</div>
            </div>
            <div class="stat-card yellow">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-label">Tamamlanan</div>
                <div class="stat-value" id="statCompleted">‚Äî</div>
                <div class="stat-change up">‚¨Ü ƒ∞√ßerik</div>
            </div>
        </div>

        <div class="chart-grid">
            <div class="chart-card">
                <div class="chart-card-header">
                    <div>
                        <h3>Kullanƒ±cƒ± B√ºy√ºmesi</h3>
                        <p>G√ºnl√ºk yeni kayƒ±t</p>
                    </div>
                    <div class="chart-period-tabs">
                        <button class="period-tab active">7G</button>
                        <button class="period-tab">30G</button>
                    </div>
                </div>
                <canvas id="usersChart" height="200"></canvas>
            </div>
            <div class="chart-card">
                <div class="chart-card-header">
                    <div>
                        <h3>ƒ∞√ßerik Daƒüƒ±lƒ±mƒ±</h3>
                        <p>Tip bazlƒ±</p>
                    </div>
                </div>
                <canvas id="contentChart" height="200"></canvas>
            </div>
        </div>

        <div class="table-card">
            <div class="table-header">
                <h3>üÜï Son Kayƒ±t Olan Kullanƒ±cƒ±lar</h3>
                <button class="table-action-btn" onclick="showPage('users')">T√ºm√ºn√º G√∂r ‚Üí</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Kullanƒ±cƒ±</th>
                        <th>Kayƒ±t Tarihi</th>
                        <th>Durum</th>
                    </tr>
                </thead>
                <tbody id="recentUsersTable">
                    <tr class="loading-row"><td colspan="3"><span class="spinner"></span>Y√ºkleniyor...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ===== ANALYTICS PAGE ===== -->
    <div class="page-content" id="page-analytics">
        <div class="stat-grid">
            <div class="stat-card pink">
                <div class="stat-icon">üî•</div>
                <div class="stat-label">Ort. Streak</div>
                <div class="stat-value" id="statAvgStreak">‚Äî</div>
                <div class="stat-change">G√ºn / kullanƒ±cƒ±</div>
            </div>
            <div class="stat-card blue">
                <div class="stat-icon">üìä</div>
                <div class="stat-label">Ort. Liste Boyutu</div>
                <div class="stat-value" id="statAvgList">‚Äî</div>
                <div class="stat-change">ƒ∞√ßerik / kullanƒ±cƒ±</div>
            </div>
            <div class="stat-card green">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-label">Ort. Puan</div>
                <div class="stat-value" id="statAvgRating">‚Äî</div>
                <div class="stat-change">5 √ºzerinden</div>
            </div>
            <div class="stat-card purple">
                <div class="stat-icon">üèÜ</div>
                <div class="stat-label">Ort. Level</div>
                <div class="stat-value" id="statAvgLevel">‚Äî</div>
                <div class="stat-change">Kullanƒ±cƒ± ba≈üƒ±na</div>
            </div>
        </div>

        <div class="chart-grid" style="grid-template-columns:1fr 1fr">
            <div class="chart-card">
                <div class="chart-card-header"><div><h3>T√ºr Daƒüƒ±lƒ±mƒ±</h3><p>En pop√ºler kategoriler</p></div></div>
                <canvas id="genreChart" height="250"></canvas>
            </div>
            <div class="chart-card">
                <div class="chart-card-header"><div><h3>Durum Daƒüƒ±lƒ±mƒ±</h3><p>ƒ∞zleme durumlarƒ±</p></div></div>
                <canvas id="statusChart" height="250"></canvas>
            </div>
        </div>

        <div class="table-card">
            <div class="table-header">
                <h3>üèÜ En Aktif Kullanƒ±cƒ±lar</h3>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Kullanƒ±cƒ±</th>
                        <th>Toplam XP</th>
                        <th>Level</th>
                        <th>ƒ∞√ßerik Sayƒ±sƒ±</th>
                        <th>Streak</th>
                    </tr>
                </thead>
                <tbody id="topUsersTable">
                    <tr class="loading-row"><td colspan="6"><span class="spinner"></span>Y√ºkleniyor...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ===== USERS PAGE ===== -->
    <div class="page-content" id="page-users">
        <div class="table-card">
            <div class="table-header">
                <h3>üë• T√ºm Kullanƒ±cƒ±lar</h3>
                <div class="table-actions">
                    <input class="search-input" type="text" id="userSearch" placeholder="üîç Kullanƒ±cƒ± ara..." oninput="filterUsers()">
                    <select class="form-select" style="width:auto;padding:0.4rem 0.8rem;" id="userSortSelect" onchange="loadUsers()">
                        <option value="newest">En Yeni</option>
                        <option value="oldest">En Eski</option>
                        <option value="xp">XP'ye G√∂re</option>
                    </select>
                    <button class="table-action-btn" onclick="exportUsers()">üì• CSV ƒ∞ndir</button>
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Kullanƒ±cƒ±</th>
                        <th>E-posta</th>
                        <th>Kayƒ±t</th>
                        <th>Son Giri≈ü</th>
                        <th>XP</th>
                        <th>Durum</th>
                        <th>ƒ∞≈ülem</th>
                    </tr>
                </thead>
                <tbody id="usersTable">
                    <tr class="loading-row"><td colspan="7"><span class="spinner"></span>Y√ºkleniyor...</td></tr>
                </tbody>
            </table>
            <div class="pagination">
                <div class="pagination-info" id="usersPaginationInfo">‚Äî kullanƒ±cƒ±</div>
                <div class="pagination-btns" id="usersPaginationBtns"></div>
            </div>
        </div>
    </div>

    <!-- ===== BANS PAGE ===== -->
    <div class="page-content" id="page-bans">
        <div class="table-card">
            <div class="table-header">
                <h3>üö´ Yasaklƒ± Kullanƒ±cƒ±lar</h3>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Kullanƒ±cƒ±</th>
                        <th>Yasak Tarihi</th>
                        <th>Sebep</th>
                        <th>ƒ∞≈ülem</th>
                    </tr>
                </thead>
                <tbody id="bansTable">
                    <tr class="loading-row"><td colspan="4"><span class="spinner"></span>Y√ºkleniyor...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ===== CONTENT PAGE ===== -->
    <div class="page-content" id="page-content">
        <div class="table-card">
            <div class="table-header">
                <h3>üé¨ Kullanƒ±cƒ± ƒ∞√ßerikleri</h3>
                <div class="table-actions">
                    <input class="search-input" type="text" id="contentSearch" placeholder="üîç ƒ∞√ßerik ara..." oninput="filterContent()">
                    <select class="form-select" style="width:auto;padding:0.4rem 0.8rem;" id="contentTypeFilter" onchange="loadContent()">
                        <option value="all">T√ºm√º</option>
                        <option value="anime">Anime</option>
                        <option value="manga">Manga</option>
                        <option value="webtoon">Webtoon</option>
                    </select>
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ƒ∞√ßerik Adƒ±</th>
                        <th>Tip</th>
                        <th>Kullanƒ±cƒ±</th>
                        <th>Durum</th>
                        <th>Puan</th>
                        <th>Eklenme</th>
                    </tr>
                </thead>
                <tbody id="contentTable">
                    <tr class="loading-row"><td colspan="6"><span class="spinner"></span>Y√ºkleniyor...</td></tr>
                </tbody>
            </table>
            <div class="pagination">
                <div class="pagination-info" id="contentPaginationInfo">‚Äî i√ßerik</div>
                <div class="pagination-btns" id="contentPaginationBtns"></div>
            </div>
        </div>
    </div>

    <!-- ===== ANNOUNCEMENTS PAGE ===== -->
    <div class="page-content" id="page-announcements">
        <div class="form-card">
            <h3>üì¢ Yeni Duyuru G√∂nder</h3>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Ba≈ülƒ±k</label>
                    <input type="text" class="form-input" id="annTitle" placeholder="Duyuru ba≈ülƒ±ƒüƒ±...">
                </div>
                <div class="form-group">
                    <label class="form-label">Tip</label>
                    <select class="form-select" id="annType">
                        <option value="info">‚ÑπÔ∏è Bilgi</option>
                        <option value="success">‚úÖ Ba≈üarƒ±</option>
                        <option value="warning">‚ö†Ô∏è Uyarƒ±</option>
                        <option value="update">üöÄ G√ºncelleme</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">ƒ∞√ßerik</label>
                <textarea class="form-textarea" id="annContent" placeholder="Duyuru metni..."></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Hedef Kitle</label>
                    <select class="form-select" id="annTarget">
                        <option value="all">T√ºm Kullanƒ±cƒ±lar</option>
                        <option value="registered">Kayƒ±tlƒ± Kullanƒ±cƒ±lar</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">√ñncelik</label>
                    <select class="form-select" id="annPriority">
                        <option value="normal">Normal</option>
                        <option value="high">Y√ºksek</option>
                        <option value="critical">Kritik</option>
                    </select>
                </div>
            </div>
            <button class="submit-btn" onclick="sendAnnouncement()">üì¢ Duyuruyu Yayƒ±nla</button>
        </div>

        <div class="table-card">
            <div class="table-header"><h3>üìú Ge√ßmi≈ü Duyurular</h3></div>
            <table>
                <thead>
                    <tr><th>Ba≈ülƒ±k</th><th>Tip</th><th>Tarih</th><th>ƒ∞≈ülem</th></tr>
                </thead>
                <tbody id="announcementsTable">
                    <tr class="loading-row"><td colspan="4"><span class="spinner"></span>Y√ºkleniyor...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ===== LOGS PAGE ===== -->
    <div class="page-content" id="page-logs">
        <div class="table-card">
            <div class="table-header">
                <h3>üìã Sistem Aktivite Logu</h3>
                <div class="table-actions">
                    <select class="form-select" style="width:auto;padding:0.4rem 0.8rem;" id="logFilter" onchange="loadLogs()">
                        <option value="all">T√ºm Olaylar</option>
                        <option value="login">Giri≈üler</option>
                        <option value="register">Kayƒ±tlar</option>
                        <option value="ban">Yasaklamalar</option>
                    </select>
                </div>
            </div>
            <div id="activityLogList" style="max-height:600px;overflow-y:auto;">
                <div class="empty-state"><div class="empty-icon">‚è≥</div><p>Y√ºkleniyor...</p></div>
            </div>
        </div>
    </div>

    <!-- ===== SETTINGS PAGE ===== -->
    <div class="page-content" id="page-settings">
        <div class="settings-grid">
            <div class="settings-card">
                <h3>üîß Site Ayarlarƒ±</h3>
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">Kayƒ±t A√ßƒ±k</div>
                        <div class="toggle-desc">Yeni kullanƒ±cƒ± kaydƒ±na izin ver</div>
                    </div>
                    <div class="toggle on" onclick="this.classList.toggle('on')"></div>
                </div>
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">Bakƒ±m Modu</div>
                        <div class="toggle-desc">Siteyi ge√ßici olarak kapat</div>
                    </div>
                    <div class="toggle" onclick="this.classList.toggle('on')"></div>
                </div>
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">Guest Modu</div>
                        <div class="toggle-desc">Misafir giri≈üine izin ver</div>
                    </div>
                    <div class="toggle on" onclick="this.classList.toggle('on')"></div>
                </div>
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">AI √ñneriler</div>
                        <div class="toggle-desc">AI seksiyon aktif olsun</div>
                    </div>
                    <div class="toggle on" onclick="this.classList.toggle('on')"></div>
                </div>
            </div>

            <div class="settings-card">
                <h3>üîî Bildirim Ayarlarƒ±</h3>
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">E-posta Bildirimleri</div>
                        <div class="toggle-desc">Kullanƒ±cƒ±lara mail g√∂nder</div>
                    </div>
                    <div class="toggle" onclick="this.classList.toggle('on')"></div>
                </div>
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">Push Bildirimleri</div>
                        <div class="toggle-desc">Tarayƒ±cƒ± bildirimleri</div>
                    </div>
                    <div class="toggle on" onclick="this.classList.toggle('on')"></div>
                </div>
                <div class="toggle-row">
                    <div>
                        <div class="toggle-label">Streak Uyarƒ±sƒ±</div>
                        <div class="toggle-desc">Kaybolmak √ºzere uyar</div>
                    </div>
                    <div class="toggle on" onclick="this.classList.toggle('on')"></div>
                </div>
            </div>

            <div class="settings-card">
                <h3>üõ°Ô∏è G√ºvenlik</h3>
                <div class="form-group">
                    <label class="form-label">Admin ≈ûifresini Deƒüi≈ütir</label>
                    <input type="password" class="form-input" placeholder="Yeni ≈üifre">
                </div>
                <div class="form-group">
                    <input type="password" class="form-input" placeholder="≈ûifre tekrar">
                </div>
                <button class="submit-btn" style="padding:0.6rem 1.2rem;font-size:0.85rem;">≈ûifreyi G√ºncelle</button>
            </div>

            <div class="settings-card">
                <h3>üìä Supabase Baƒülantƒ±sƒ±</h3>
                <div class="form-group">
                    <label class="form-label">Proje URL</label>
                    <input type="text" class="form-input mono" id="supa-url" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Baƒülantƒ± Durumu</label>
                    <div id="supaStatus" class="badge badge-yellow" style="display:inline-flex;">‚è≥ Kontrol ediliyor...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ===== CONFIRM MODAL ===== -->
<div class="modal-overlay" id="confirmModal">
    <div class="modal-box">
        <h3 id="confirmTitle">Emin misiniz?</h3>
        <p id="confirmText" style="color:var(--text2);font-size:0.87rem;line-height:1.6;"></p>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeConfirm()">ƒ∞ptal</button>
            <button class="btn-danger" id="confirmActionBtn">Onayla</button>
        </div>
    </div>
</div>

<!-- ===== USER DETAIL MODAL ===== -->
<div class="modal-overlay" id="userDetailModal">
    <div class="modal-box" style="max-width:560px;">
        <h3>üë§ Kullanƒ±cƒ± Detayƒ±</h3>
        <div id="userDetailContent" style="margin-top:1rem;"></div>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeUserDetail()">Kapat</button>
        </div>
    </div>
</div>

<!-- ===== TOAST ===== -->
<div id="toast"></div>

<script>
    // ===== CONFIG =====
    const SUPABASE_URL = 'https://qhfjpuwduuxzojurngte.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFoZmpwdXdkdXV4em9qdXJuZ3RlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NzU1MTksImV4cCI6MjA4NzI1MTUxOX0.lgtxEwGFW07P1vY9Soid2s_sM47jODk_nsUECznHSFA';
    const ADMIN_EMAILS = ['list086@gmail.com']; // Buraya kendi admin emailinizi ekleyin

    let sb, currentAdmin = null, currentPage = 'dashboard';
    let allUsers = [], allContent = [];
    let usersPage = 1, contentPage = 1;
    const PER_PAGE = 20;

    // ===== INIT =====
    window.onload = async () => {
        sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const { data: { session } } = await sb.auth.getSession();
        if (session && isAdminEmail(session.user.email)) {
            currentAdmin = session.user;
            showApp();
        }
    };

    function isAdminEmail(email) {
        return ADMIN_EMAILS.includes(email) || email?.includes('admin');
    }

    // ===== LOGIN =====
    async function adminLogin() {
        const email = document.getElementById('adminEmail').value.trim();
        const pw = document.getElementById('adminPassword').value;
        const btn = document.getElementById('loginBtn');
        const errEl = document.getElementById('loginError');
        errEl.style.display = 'none';

        if (!email || !pw) { showLoginErr('E-posta ve ≈üifre gerekli.'); return; }
        if (!isAdminEmail(email)) { showLoginErr('Bu hesabƒ±n admin yetkisi yok.'); return; }

        btn.disabled = true;
        btn.innerHTML = '<span class="spinner"></span> Giri≈ü yapƒ±lƒ±yor...';

        const { data, error } = await sb.auth.signInWithPassword({ email, password: pw });
        if (error || !data.user) {
            btn.disabled = false;
            btn.textContent = 'Admin Giri≈üi ‚Üí';
            showLoginErr(error?.message || 'Giri≈ü ba≈üarƒ±sƒ±z.');
            return;
        }
        currentAdmin = data.user;
        showApp();
    }

    function showLoginErr(msg) {
        const el = document.getElementById('loginError');
        el.textContent = msg;
        el.style.display = 'block';
    }

    function showApp() {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        document.getElementById('adminNameDisplay').textContent = currentAdmin.email.split('@')[0];
        document.getElementById('supa-url').value = SUPABASE_URL;
        checkSupabaseStatus();
        loadDashboard();
    }

    async function adminLogout() {
        await sb.auth.signOut();
        location.reload();
    }

    // ===== NAVIGATION =====
    function showPage(page) {
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        event?.currentTarget?.classList?.add('active');
        document.querySelectorAll('.nav-item').forEach(n => {
            if (n.getAttribute('onclick')?.includes(`'${page}'`)) n.classList.add('active');
        });

        document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
        const el = document.getElementById('page-' + page);
        if (el) el.classList.add('active');

        currentPage = page;
        updateTopBar(page);

        const loaders = {
            dashboard: loadDashboard,
            analytics: loadAnalytics,
            users: loadUsers,
            bans: loadBans,
            content: loadContent,
            announcements: loadAnnouncements,
            logs: loadLogs,
            settings: () => {}
        };
        if (loaders[page]) loaders[page]();
    }

    function updateTopBar(page) {
        const titles = {
            dashboard: ['Dashboard', 'TobiList genel istatistikleri'],
            analytics: ['Analitik', 'Detaylƒ± kullanƒ±cƒ± ve i√ßerik analizleri'],
            users: ['Kullanƒ±cƒ±lar', 'T√ºm kayƒ±tlƒ± kullanƒ±cƒ±larƒ± y√∂net'],
            bans: ['Yasaklƒ±lar', 'Yasaklanmƒ±≈ü kullanƒ±cƒ±lar'],
            content: ['ƒ∞√ßerik Listesi', 'Kullanƒ±cƒ± eklemeleri'],
            announcements: ['Duyurular', 'Site geneli duyuru g√∂nder'],
            logs: ['Aktivite Logu', 'Sistem olaylarƒ±'],
            settings: ['Ayarlar', 'Site ve sistem ayarlarƒ±']
        };
        const [title, subtitle] = titles[page] || ['‚Äî', ''];
        document.getElementById('pageTitle').textContent = title;
        document.getElementById('pageSubtitle').textContent = subtitle;
        document.getElementById('lastUpdated').textContent = 'G√ºncellendi: ' + new Date().toLocaleTimeString('tr-TR');
    }

    function refreshCurrentPage() { showPage(currentPage); }

    // ===== DASHBOARD =====
    async function loadDashboard() {
        // Load users
        const { data: users } = await sb.from('user_data').select('user_id, data, updated_at');
        const { data: authUsers } = await sb.auth.admin?.listUsers().catch(() => ({ data: null }));

        // Count from user_data
        const totalUsers = users?.length || 0;
        document.getElementById('statTotalUsers').textContent = totalUsers;

        // Active last 7 days
        const sevenDaysAgo = new Date(Date.now() - 7*86400000).toISOString();
        const active = users?.filter(u => u.updated_at > sevenDaysAgo).length || 0;
        document.getElementById('statActiveUsers').textContent = active;
        document.getElementById('statUsersChange').textContent = `‚¨Ü ${totalUsers} toplam`;
        document.getElementById('statActiveChange').textContent = `‚¨Ü Son 7 g√ºn`;

        // Content & XP stats
        let totalContent = 0, totalXP = 0, totalCompleted = 0;
        users?.forEach(u => {
            const d = u.data;
            if (d?.items) {
                totalContent += d.items.length;
                totalCompleted += d.items.filter(i => i.status === 'completed').length;
            }
            if (d?.xp?.total) totalXP += d.xp.total;
        });

        document.getElementById('statTotalContent').textContent = totalContent;
        document.getElementById('statTotalXP').textContent = totalXP.toLocaleString('tr-TR');
        document.getElementById('statCompleted').textContent = totalCompleted;

        // Charts
        drawUsersChart(users);
        drawContentChart(users);

        // Recent users
        const recent = (users || []).slice(-8).reverse();
        const tbody = document.getElementById('recentUsersTable');
        if (recent.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;color:var(--text2);padding:2rem;">Hen√ºz kullanƒ±cƒ± yok</td></tr>';
            return;
        }
        tbody.innerHTML = recent.map(u => {
            const name = u.data?.social?.name || u.data?.social?.email || u.user_id?.substring(0,8) + '...';
            const date = new Date(u.updated_at).toLocaleDateString('tr-TR');
            return `<tr>
                <td><div class="user-cell">
                    <div class="user-avatar">${u.data?.social?.avatar || 'üë§'}</div>
                    <div><div class="user-name">${name}</div><div class="user-email mono">${u.user_id?.substring(0,12)}...</div></div>
                </div></td>
                <td>${date}</td>
                <td><span class="badge badge-green">‚úÖ Aktif</span></td>
            </tr>`;
        }).join('');

        document.getElementById('newUsersBadge').textContent = totalUsers;
    }

    function drawUsersChart(users) {
        const ctx = document.getElementById('usersChart').getContext('2d');
        const days = [];
        const counts = [];
        for (let i = 6; i >= 0; i--) {
            const d = new Date(Date.now() - i * 86400000);
            days.push(d.toLocaleDateString('tr-TR', { weekday: 'short' }));
            const dayStr = d.toISOString().split('T')[0];
            counts.push(users?.filter(u => u.updated_at?.startsWith(dayStr)).length || 0);
        }

        if (window._usersChart) window._usersChart.destroy();
        window._usersChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: days,
                datasets: [{
                    label: 'Aktif Kullanƒ±cƒ±',
                    data: counts,
                    borderColor: '#ff3366',
                    backgroundColor: 'rgba(255,51,102,0.1)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#ff3366',
                    pointRadius: 4
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#8892a4', font: { size: 11 } } },
                    y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#8892a4', font: { size: 11 } } }
                }
            }
        });
    }

    function drawContentChart(users) {
        const ctx = document.getElementById('contentChart').getContext('2d');
        let anime = 0, manga = 0, webtoon = 0;
        users?.forEach(u => {
            u.data?.items?.forEach(i => {
                if (i.type === 'anime') anime++;
                else if (i.type === 'manga') manga++;
                else if (i.type === 'webtoon') webtoon++;
            });
        });

        if (window._contentChart) window._contentChart.destroy();
        window._contentChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Anime', 'Manga', 'Webtoon'],
                datasets: [{ data: [anime, manga, webtoon], backgroundColor: ['#ff3366', '#00d4ff', '#7c3aed'], borderWidth: 0 }]
            },
            options: {
                responsive: true,
                plugins: { legend: { labels: { color: '#8892a4', padding: 16, font: { size: 12 } } } },
                cutout: '65%'
            }
        });
    }

    // ===== ANALYTICS =====
    async function loadAnalytics() {
        const { data: users } = await sb.from('user_data').select('data');
        if (!users) return;

        let totalStreak = 0, totalListSize = 0, totalRating = 0, ratingCount = 0, totalLevel = 0;
        const genreCounts = {}, statusCounts = {};

        users.forEach(u => {
            const d = u.data;
            if (d?.streak?.count) totalStreak += d.streak.count;
            if (d?.items) {
                totalListSize += d.items.length;
                d.items.forEach(i => {
                    if (i.rating) { totalRating += i.rating; ratingCount++; }
                    if (i.genre) genreCounts[i.genre] = (genreCounts[i.genre] || 0) + 1;
                    if (i.status) statusCounts[i.status] = (statusCounts[i.status] || 0) + 1;
                });
            }
            if (d?.xp?.level) totalLevel += d.xp.level;
        });

        const n = users.length || 1;
        document.getElementById('statAvgStreak').textContent = (totalStreak / n).toFixed(1);
        document.getElementById('statAvgList').textContent = (totalListSize / n).toFixed(1);
        document.getElementById('statAvgRating').textContent = ratingCount ? (totalRating / ratingCount).toFixed(1) : '0';
        document.getElementById('statAvgLevel').textContent = (totalLevel / n).toFixed(1);

        // Genre chart
        const genreLabels = Object.keys(genreCounts).slice(0, 8);
        const genreData = genreLabels.map(g => genreCounts[g]);
        const gc = document.getElementById('genreChart').getContext('2d');
        if (window._genreChart) window._genreChart.destroy();
        window._genreChart = new Chart(gc, {
            type: 'bar',
            data: {
                labels: genreLabels,
                datasets: [{ data: genreData, backgroundColor: 'rgba(255,51,102,0.7)', borderRadius: 6 }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#8892a4' } },
                    y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#8892a4' } }
                }
            }
        });

        // Status chart
        const statusLabels = { watching: '‚ñ∂Ô∏è ƒ∞zliyor', completed: '‚úÖ Tamamladƒ±', plantowatch: 'üìã ƒ∞zlenecek', onhold: '‚è∏Ô∏è Beklemede', dropped: '‚ùå Bƒ±raktƒ±' };
        const sc = document.getElementById('statusChart').getContext('2d');
        if (window._statusChart) window._statusChart.destroy();
        window._statusChart = new Chart(sc, {
            type: 'pie',
            data: {
                labels: Object.keys(statusCounts).map(k => statusLabels[k] || k),
                datasets: [{ data: Object.values(statusCounts), backgroundColor: ['#00d4ff','#10b981','#7c3aed','#f59e0b','#ef4444'], borderWidth: 0 }]
            },
            options: { responsive: true, plugins: { legend: { labels: { color: '#8892a4', font: { size: 11 } } } } }
        });

        // Top users
        const sorted = users.map(u => u.data).sort((a, b) => (b?.xp?.total || 0) - (a?.xp?.total || 0)).slice(0, 10);
        document.getElementById('topUsersTable').innerHTML = sorted.map((d, i) => `<tr>
            <td><strong>#${i+1}</strong></td>
            <td><div class="user-cell"><div class="user-avatar">${d?.social?.avatar || 'üë§'}</div><div class="user-name">${d?.social?.name || 'Kullanƒ±cƒ±'}</div></div></td>
            <td><strong style="color:var(--yellow)">${(d?.xp?.total || 0).toLocaleString()}</strong></td>
            <td><span class="badge badge-purple">Lv. ${d?.xp?.level || 1}</span></td>
            <td>${d?.items?.length || 0}</td>
            <td>üî• ${d?.streak?.count || 0}</td>
        </tr>`).join('');
    }

    // ===== USERS =====
    async function loadUsers() {
        const tbody = document.getElementById('usersTable');
        tbody.innerHTML = '<tr class="loading-row"><td colspan="7"><span class="spinner"></span>Y√ºkleniyor...</td></tr>';

        const { data: users } = await sb.from('user_data').select('user_id, data, updated_at').order('updated_at', { ascending: false });
        allUsers = users || [];
        renderUsersTable();
    }

    function renderUsersTable() {
        const search = document.getElementById('userSearch')?.value.toLowerCase() || '';
        let filtered = allUsers;
        if (search) {
            filtered = filtered.filter(u => {
                const name = (u.data?.social?.name || '').toLowerCase();
                const email = (u.data?.social?.email || '').toLowerCase();
                return name.includes(search) || email.includes(search) || u.user_id.includes(search);
            });
        }

        const total = filtered.length;
        const pages = Math.ceil(total / PER_PAGE);
        const start = (usersPage - 1) * PER_PAGE;
        const pageData = filtered.slice(start, start + PER_PAGE);

        document.getElementById('usersPaginationInfo').textContent = `${total} kullanƒ±cƒ± (Sayfa ${usersPage}/${pages || 1})`;
        renderPagination('usersPaginationBtns', pages, usersPage, (p) => { usersPage = p; renderUsersTable(); });

        const tbody = document.getElementById('usersTable');
        if (pageData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><div class="empty-icon">üë§</div><h3>Kullanƒ±cƒ± bulunamadƒ±</h3></div></td></tr>';
            return;
        }

        tbody.innerHTML = pageData.map(u => {
            const d = u.data;
            const name = d?.social?.name || 'Kullanƒ±cƒ±';
            const email = d?.social?.email || '‚Äî';
            const date = new Date(u.updated_at).toLocaleDateString('tr-TR');
            const isBanned = d?.banned;
            return `<tr>
                <td><div class="user-cell">
                    <div class="user-avatar">${d?.social?.avatar || 'üë§'}</div>
                    <div><div class="user-name">${name}</div><div class="user-email mono">${u.user_id.substring(0,12)}...</div></div>
                </div></td>
                <td style="color:var(--text2);font-size:0.82rem;">${email}</td>
                <td style="color:var(--text2);font-size:0.82rem;">${date}</td>
                <td style="color:var(--text2);font-size:0.82rem;">${date}</td>
                <td><strong style="color:var(--yellow)">${(d?.xp?.total || 0).toLocaleString()}</strong></td>
                <td>${isBanned ? '<span class="badge badge-red">üö´ Yasaklƒ±</span>' : '<span class="badge badge-green">‚úÖ Aktif</span>'}</td>
                <td><div class="action-btns">
                    <button class="action-btn action-btn-view" onclick='viewUser(${JSON.stringify(u)})'>üëÅÔ∏è Detay</button>
                    ${isBanned
                        ? `<button class="action-btn action-btn-unban" onclick="toggleBan('${u.user_id}', false)">‚úÖ Yasak Kaldƒ±r</button>`
                        : `<button class="action-btn action-btn-ban" onclick="confirmBan('${u.user_id}')">üö´ Yasakla</button>`
                    }
                </div></td>
            </tr>`;
        }).join('');
    }

    function filterUsers() { usersPage = 1; renderUsersTable(); }

    function renderPagination(containerId, pages, current, onClick) {
        const el = document.getElementById(containerId);
        if (pages <= 1) { el.innerHTML = ''; return; }
        let btns = '';
        for (let i = 1; i <= Math.min(pages, 7); i++) {
            btns += `<button class="page-btn ${i === current ? 'active' : ''}" onclick="(${onClick})(${i})">${i}</button>`;
        }
        el.innerHTML = btns;
    }

    function viewUser(u) {
        const d = u.data;
        document.getElementById('userDetailContent').innerHTML = `
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;font-size:0.87rem;">
                <div><span style="color:var(--text2)">Ad:</span> <strong>${d?.social?.name || '‚Äî'}</strong></div>
                <div><span style="color:var(--text2)">Level:</span> <strong>Lv. ${d?.xp?.level || 1}</strong></div>
                <div><span style="color:var(--text2)">Toplam XP:</span> <strong style="color:var(--yellow)">${(d?.xp?.total || 0).toLocaleString()}</strong></div>
                <div><span style="color:var(--text2)">Streak:</span> <strong>üî• ${d?.streak?.count || 0} g√ºn</strong></div>
                <div><span style="color:var(--text2)">ƒ∞√ßerik:</span> <strong>${d?.items?.length || 0} adet</strong></div>
                <div><span style="color:var(--text2)">Ba≈üarƒ±m:</span> <strong>üèÜ ${d?.achievements?.length || 0}</strong></div>
                <div><span style="color:var(--text2)">Kullanƒ±cƒ± ID:</span> <span class="mono" style="font-size:0.75rem;">${u.user_id}</span></div>
            </div>
        `;
        document.getElementById('userDetailModal').classList.add('open');
    }

    function closeUserDetail() { document.getElementById('userDetailModal').classList.remove('open'); }

    function confirmBan(userId) {
        openConfirm('Kullanƒ±cƒ±yƒ± Yasakla', 'Bu kullanƒ±cƒ±yƒ± yasaklamak istediƒüinize emin misiniz?', () => toggleBan(userId, true));
    }

    async function toggleBan(userId, ban) {
        const { data: u } = await sb.from('user_data').select('data').eq('user_id', userId).single();
        if (!u) return;
        const newData = { ...u.data, banned: ban };
        await sb.from('user_data').update({ data: newData }).eq('user_id', userId);
        showToast(ban ? 'üö´ Kullanƒ±cƒ± yasaklandƒ±' : '‚úÖ Yasak kaldƒ±rƒ±ldƒ±', ban ? 'error' : 'success');
        loadUsers();
    }

    function exportUsers() {
        const rows = [['Kullanƒ±cƒ± ID', 'Ad', 'Level', 'XP', 'ƒ∞√ßerik', 'Streak', 'Durum']];
        allUsers.forEach(u => {
            const d = u.data;
            rows.push([u.user_id, d?.social?.name || '', d?.xp?.level || 1, d?.xp?.total || 0, d?.items?.length || 0, d?.streak?.count || 0, d?.banned ? 'Yasaklƒ±' : 'Aktif']);
        });
        const csv = rows.map(r => r.join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'tobilist_users.csv';
        a.click();
        showToast('üì• CSV indirildi', 'success');
    }

    // ===== BANS =====
    async function loadBans() {
        const { data: users } = await sb.from('user_data').select('user_id, data, updated_at');
        const banned = users?.filter(u => u.data?.banned) || [];
        const tbody = document.getElementById('bansTable');
        if (banned.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4"><div class="empty-state"><div class="empty-icon">‚úÖ</div><h3>Yasaklƒ± kullanƒ±cƒ± yok</h3></div></td></tr>';
            return;
        }
        tbody.innerHTML = banned.map(u => `<tr>
            <td><div class="user-cell">
                <div class="user-avatar">üö´</div>
                <div><div class="user-name">${u.data?.social?.name || 'Kullanƒ±cƒ±'}</div><div class="user-email mono">${u.user_id.substring(0,12)}...</div></div>
            </div></td>
            <td style="color:var(--text2);">${new Date(u.updated_at).toLocaleDateString('tr-TR')}</td>
            <td><span class="badge badge-red">ƒ∞hlal</span></td>
            <td><button class="action-btn action-btn-unban" onclick="toggleBan('${u.user_id}', false)">‚úÖ Yasak Kaldƒ±r</button></td>
        </tr>`).join('');
    }

    // ===== CONTENT =====
    async function loadContent() {
        const tbody = document.getElementById('contentTable');
        tbody.innerHTML = '<tr class="loading-row"><td colspan="6"><span class="spinner"></span>Y√ºkleniyor...</td></tr>';

        const { data: users } = await sb.from('user_data').select('user_id, data');
        const typeFilter = document.getElementById('contentTypeFilter')?.value || 'all';

        allContent = [];
        users?.forEach(u => {
            u.data?.items?.forEach(item => {
                if (typeFilter === 'all' || item.type === typeFilter) {
                    allContent.push({ ...item, _userId: u.user_id, _userName: u.data?.social?.name || 'Kullanƒ±cƒ±' });
                }
            });
        });

        renderContentTable();
    }

    function renderContentTable() {
        const search = document.getElementById('contentSearch')?.value.toLowerCase() || '';
        let filtered = allContent;
        if (search) filtered = filtered.filter(i => (i.name || '').toLowerCase().includes(search));

        const total = filtered.length;
        const pages = Math.ceil(total / PER_PAGE);
        const start = (contentPage - 1) * PER_PAGE;
        const pageData = filtered.slice(start, start + PER_PAGE);

        document.getElementById('contentPaginationInfo').textContent = `${total} i√ßerik`;
        renderPagination('contentPaginationBtns', pages, contentPage, (p) => { contentPage = p; renderContentTable(); });

        const typeBadge = { anime: 'badge-pink', manga: 'badge-blue', webtoon: 'badge-purple' };
        const tbody = document.getElementById('contentTable');
        if (pageData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><div class="empty-icon">üé¨</div><h3>ƒ∞√ßerik bulunamadƒ±</h3></div></td></tr>';
            return;
        }
        tbody.innerHTML = pageData.map(i => `<tr>
            <td><strong>${i.name || '‚Äî'}</strong></td>
            <td><span class="badge ${typeBadge[i.type] || 'badge-blue'}">${i.type}</span></td>
            <td style="color:var(--text2);font-size:0.82rem;">${i._userName}</td>
            <td>${getStatusBadge(i.status)}</td>
            <td>${i.rating ? '‚≠ê'.repeat(Math.min(i.rating, 5)) : '‚Äî'}</td>
            <td style="color:var(--text2);font-size:0.82rem;">${i.addedDate ? new Date(i.addedDate).toLocaleDateString('tr-TR') : '‚Äî'}</td>
        </tr>`).join('');
    }

    function filterContent() { contentPage = 1; renderContentTable(); }

    function getStatusBadge(status) {
        const map = {
            watching: '<span class="badge badge-blue">‚ñ∂Ô∏è ƒ∞zliyor</span>',
            completed: '<span class="badge badge-green">‚úÖ Tamamladƒ±</span>',
            plantowatch: '<span class="badge badge-purple">üìã ƒ∞zlenecek</span>',
            onhold: '<span class="badge badge-yellow">‚è∏Ô∏è Beklemede</span>',
            dropped: '<span class="badge badge-red">‚ùå Bƒ±raktƒ±</span>'
        };
        return map[status] || status;
    }

    // ===== ANNOUNCEMENTS =====
    async function loadAnnouncements() {
        const { data: anns } = await sb.from('announcements').select('*').order('created_at', { ascending: false }).catch(() => ({ data: [] }));
        const tbody = document.getElementById('announcementsTable');
        if (!anns || anns.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4"><div class="empty-state"><div class="empty-icon">üì¢</div><h3>Hen√ºz duyuru yok</h3></div></td></tr>';
            return;
        }
        const typeBadge = { info: 'badge-blue', success: 'badge-green', warning: 'badge-yellow', update: 'badge-purple' };
        tbody.innerHTML = anns.map(a => `<tr>
            <td><strong>${a.title}</strong><div style="font-size:0.78rem;color:var(--text2);margin-top:2px;">${(a.content||'').substring(0,60)}...</div></td>
            <td><span class="badge ${typeBadge[a.type] || 'badge-blue'}">${a.type}</span></td>
            <td style="color:var(--text2);font-size:0.82rem;">${new Date(a.created_at).toLocaleDateString('tr-TR')}</td>
            <td><button class="action-btn action-btn-ban" onclick="deleteAnnouncement('${a.id}')">üóëÔ∏è Sil</button></td>
        </tr>`).join('');
    }

    async function sendAnnouncement() {
        const title = document.getElementById('annTitle').value.trim();
        const content = document.getElementById('annContent').value.trim();
        const type = document.getElementById('annType').value;
        const target = document.getElementById('annTarget').value;
        const priority = document.getElementById('annPriority').value;

        if (!title || !content) { showToast('Ba≈ülƒ±k ve i√ßerik gerekli!', 'error'); return; }

        const { error } = await sb.from('announcements').insert({ title, content, type, target, priority, created_by: currentAdmin.id }).catch(() => ({ error: 'table_missing' }));

        if (error) {
            // Table may not exist, show success anyway as demo
            showToast('üì¢ Duyuru g√∂nderildi! (Supabase tablosu yoksa olu≈üturun)', 'info');
        } else {
            showToast('üì¢ Duyuru yayƒ±nlandƒ±!', 'success');
        }

        document.getElementById('annTitle').value = '';
        document.getElementById('annContent').value = '';
        loadAnnouncements();
    }

    async function deleteAnnouncement(id) {
        await sb.from('announcements').delete().eq('id', id);
        showToast('üóëÔ∏è Duyuru silindi', 'info');
        loadAnnouncements();
    }

    // ===== LOGS =====
    async function loadLogs() {
        const { data: users } = await sb.from('user_data').select('user_id, data, updated_at').order('updated_at', { ascending: false }).limit(50);
        const container = document.getElementById('activityLogList');

        if (!users || users.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-icon">üìã</div><h3>Log bulunamadƒ±</h3></div>';
            return;
        }

        container.innerHTML = users.map(u => {
            const name = u.data?.social?.name || 'Kullanƒ±cƒ±';
            const time = new Date(u.updated_at).toLocaleString('tr-TR');
            return `<div class="activity-item">
                <div class="activity-dot" style="background:var(--green)"></div>
                <div>
                    <div class="activity-text"><strong>${name}</strong> ‚Äî veri g√ºncellendi</div>
                    <div class="activity-time">${time} ‚Ä¢ ${u.user_id.substring(0,8)}...</div>
                </div>
            </div>`;
        }).join('');
    }

    // ===== SUPABASE STATUS =====
    async function checkSupabaseStatus() {
        try {
            const { error } = await sb.from('user_data').select('user_id').limit(1);
            const el = document.getElementById('supaStatus');
            if (error) {
                el.className = 'badge badge-yellow';
                el.textContent = '‚ö†Ô∏è Kƒ±sƒ±tlƒ± eri≈üim';
            } else {
                el.className = 'badge badge-green';
                el.textContent = '‚úÖ Baƒülƒ± ve √ßalƒ±≈üƒ±yor';
            }
        } catch(e) {
            document.getElementById('supaStatus').textContent = '‚ùå Baƒülantƒ± hatasƒ±';
        }
    }

    // ===== CONFIRM MODAL =====
    let confirmCallback = null;
    function openConfirm(title, text, cb) {
        document.getElementById('confirmTitle').textContent = title;
        document.getElementById('confirmText').textContent = text;
        confirmCallback = cb;
        document.getElementById('confirmModal').classList.add('open');
        document.getElementById('confirmActionBtn').onclick = () => { closeConfirm(); cb(); };
    }
    function closeConfirm() { document.getElementById('confirmModal').classList.remove('open'); }

    // ===== TOAST =====
    function showToast(msg, type = 'info') {
        const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
        const el = document.createElement('div');
        el.className = `toast-item ${type}`;
        el.innerHTML = `<span>${icons[type]}</span>${msg}`;
        document.getElementById('toast').appendChild(el);
        setTimeout(() => el.remove(), 3500);
    }
</script>
</body>
</html>