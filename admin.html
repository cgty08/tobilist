<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TobiList ‚Äî Admin Panel</title>
    <meta name="robots" content="noindex, nofollow">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg:#07090f; --bg2:#0d1117; --bg3:#111827;
            --card:#161d2b; --card2:#1c2537;
            --border:rgba(255,255,255,0.07); --border2:rgba(255,255,255,0.12);
            --text:#e2e8f0; --text2:#8892a4; --text3:#4b5563;
            --accent:#ff3366; --accent2:#00d4ff; --accent3:#7c3aed;
            --green:#10b981; --yellow:#f59e0b; --red:#ef4444;
            --sidebar-w:260px;
        }
        *{margin:0;padding:0;box-sizing:border-box;}
        body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;display:flex;}

        /* ---- LOGIN ---- */
        #loginScreen{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:var(--bg);}
        #loginScreen::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 20% 20%,rgba(255,51,102,.15),transparent 50%),radial-gradient(ellipse at 80% 80%,rgba(124,58,237,.12),transparent 50%);pointer-events:none;}
        .login-box{position:relative;z-index:1;background:var(--card);border:1px solid var(--border2);border-radius:20px;padding:2.5rem;width:100%;max-width:400px;box-shadow:0 40px 100px rgba(0,0,0,.6);}
        .login-logo{display:flex;align-items:center;gap:.6rem;margin-bottom:.3rem;}
        .tobi-mask-svg{width:40px;height:40px;}
        .login-logo-text{font-family:'Bebas Neue',cursive;font-size:2rem;letter-spacing:4px;background:linear-gradient(135deg,#ff3366,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
        .login-sub{color:var(--text2);font-size:.85rem;margin-bottom:2rem;}
        .login-sub span{background:rgba(255,51,102,.15);color:var(--accent);padding:2px 8px;border-radius:4px;font-size:.78rem;font-weight:700;letter-spacing:1px;}
        .lf{margin-bottom:1rem;}
        .lf label{display:block;font-size:.82rem;color:var(--text2);margin-bottom:.4rem;font-weight:600;}
        .lf input{width:100%;padding:.85rem 1rem;background:rgba(255,255,255,.04);border:1px solid var(--border2);border-radius:10px;color:var(--text);font-size:.9rem;font-family:'DM Sans',sans-serif;outline:none;transition:all .25s;}
        .lf input:focus{border-color:var(--accent);background:rgba(255,51,102,.05);box-shadow:0 0 0 3px rgba(255,51,102,.1);}
        .login-err{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:var(--red);padding:.6rem .9rem;border-radius:8px;font-size:.83rem;margin-bottom:1rem;display:none;}
        .login-btn{width:100%;padding:.9rem;background:linear-gradient(135deg,var(--accent),#ff5580);border:none;border-radius:10px;color:#fff;font-size:.95rem;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;transition:all .25s;box-shadow:0 4px 20px rgba(255,51,102,.3);}
        .login-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(255,51,102,.45);}
        .login-btn:disabled{opacity:.7;transform:none;cursor:not-allowed;}

        /* ---- SIDEBAR ---- */
        #sidebar{width:var(--sidebar-w);min-height:100vh;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;left:0;top:0;bottom:0;z-index:100;}
        .sb-logo{padding:1.3rem 1.5rem;border-bottom:1px solid var(--border);}
        .sb-logo-row{display:flex;align-items:center;gap:.5rem;}
        .sb-logo-text{font-family:'Bebas Neue',cursive;font-size:1.35rem;letter-spacing:3px;background:linear-gradient(135deg,#ff3366,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
        .sb-sub{font-size:.68rem;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-top:1px;}
        .sb-section{padding:.9rem 1.5rem .35rem;font-size:.68rem;font-weight:700;letter-spacing:2px;color:var(--text3);text-transform:uppercase;}
        .sb-nav{flex:1;overflow-y:auto;padding:.4rem 0;}
        .nav-item{display:flex;align-items:center;gap:.75rem;padding:.72rem 1.5rem;cursor:pointer;color:var(--text2);font-size:.87rem;font-weight:500;transition:all .2s;border-left:3px solid transparent;}
        .nav-item:hover{background:rgba(255,255,255,.04);color:var(--text);}
        .nav-item.active{background:rgba(255,51,102,.08);color:var(--accent);border-left-color:var(--accent);}
        .nav-icon{font-size:1.05rem;width:20px;text-align:center;}
        .nav-badge{margin-left:auto;background:var(--accent);color:#fff;font-size:.68rem;font-weight:700;padding:2px 7px;border-radius:20px;min-width:20px;text-align:center;}
        .sb-footer{padding:1rem 1.5rem;border-top:1px solid var(--border);}
        .admin-info{display:flex;align-items:center;gap:.7rem;margin-bottom:.8rem;}
        .admin-av{width:36px;height:36px;background:linear-gradient(135deg,var(--accent),var(--accent3));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1rem;}
        .admin-name{font-size:.85rem;font-weight:600;}
        .admin-role{font-size:.72rem;color:var(--accent);}
        .logout-btn{width:100%;padding:.5rem;background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);border-radius:8px;color:var(--red);font-size:.82rem;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s;}
        .logout-btn:hover{background:rgba(239,68,68,.15);}

        /* ---- MAIN ---- */
        #mainContent{margin-left:var(--sidebar-w);flex:1;min-height:100vh;display:none;}
        .top-bar{background:var(--bg2);border-bottom:1px solid var(--border);padding:1rem 2rem;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
        .page-title-bar h1{font-size:1.3rem;font-weight:700;}
        .page-title-bar p{font-size:.82rem;color:var(--text2);margin-top:2px;}
        .top-actions{display:flex;align-items:center;gap:.8rem;}
        .live-badge{display:flex;align-items:center;gap:.5rem;background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.25);padding:.35rem .8rem;border-radius:20px;font-size:.78rem;color:var(--green);font-weight:600;}
        .live-dot{width:7px;height:7px;background:var(--green);border-radius:50%;animation:pulse 2s infinite;}
        @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.8)}}
        .refresh-btn{padding:.42rem .9rem;background:rgba(255,255,255,.05);border:1px solid var(--border2);border-radius:8px;color:var(--text2);font-size:.82rem;font-family:'DM Sans',sans-serif;cursor:pointer;transition:all .2s;}
        .refresh-btn:hover{background:rgba(255,255,255,.08);color:var(--text);}

        /* ---- PAGES ---- */
        .page{padding:2rem;display:none;}
        .page.active{display:block;}

        /* ---- STAT CARDS ---- */
        .stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(185px,1fr));gap:1rem;margin-bottom:2rem;}
        .stat-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:1.4rem;position:relative;overflow:hidden;transition:all .25s;}
        .stat-card:hover{border-color:var(--border2);transform:translateY(-2px);}
        .stat-card::before{content:'';position:absolute;top:0;right:0;width:80px;height:80px;border-radius:50%;opacity:.08;transform:translate(20px,-20px);}
        .stat-card.c-blue::before{background:var(--accent2);}
        .stat-card.c-pink::before{background:var(--accent);}
        .stat-card.c-purple::before{background:var(--accent3);}
        .stat-card.c-green::before{background:var(--green);}
        .stat-card.c-yellow::before{background:var(--yellow);}
        .stat-icon{font-size:1.5rem;margin-bottom:.8rem;}
        .stat-label{font-size:.75rem;color:var(--text2);font-weight:600;letter-spacing:.5px;text-transform:uppercase;margin-bottom:.3rem;}
        .stat-value{font-size:2rem;font-weight:900;line-height:1;margin-bottom:.4rem;}
        .stat-card.c-blue .stat-value{color:var(--accent2);}
        .stat-card.c-pink .stat-value{color:var(--accent);}
        .stat-card.c-purple .stat-value{color:var(--accent3);}
        .stat-card.c-green .stat-value{color:var(--green);}
        .stat-card.c-yellow .stat-value{color:var(--yellow);}
        .stat-change{font-size:.75rem;color:var(--text2);}
        .stat-change.up{color:var(--green);}

        /* ---- CHARTS ---- */
        .chart-grid-2{display:grid;grid-template-columns:2fr 1fr;gap:1.5rem;margin-bottom:2rem;}
        .chart-grid-eq{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:2rem;}
        .chart-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:1.5rem;}
        .chart-card h3{font-size:1rem;font-weight:700;margin-bottom:.4rem;}
        .chart-card p{font-size:.78rem;color:var(--text2);margin-bottom:1.2rem;}

        /* ---- TABLE ---- */
        .table-card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:1.5rem;}
        .table-header{padding:1.2rem 1.5rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.5rem;}
        .table-header h3{font-size:1rem;font-weight:700;}
        .table-actions{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;}
        .search-inp{padding:.4rem .8rem;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:.82rem;font-family:'DM Sans',sans-serif;outline:none;width:200px;transition:all .2s;}
        .search-inp:focus{border-color:var(--accent);}
        .search-inp::placeholder{color:var(--text3);}
        .tbl-btn{padding:.4rem .8rem;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:8px;color:var(--text2);font-size:.8rem;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s;}
        .tbl-btn:hover{background:rgba(255,255,255,.08);color:var(--text);}
        table{width:100%;border-collapse:collapse;}
        th{padding:.75rem 1.5rem;text-align:left;font-size:.72rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text3);background:rgba(255,255,255,.02);border-bottom:1px solid var(--border);}
        td{padding:.95rem 1.5rem;font-size:.87rem;border-bottom:1px solid var(--border);vertical-align:middle;}
        tr:last-child td{border-bottom:none;}
        tr:hover td{background:rgba(255,255,255,.02);}
        .user-cell{display:flex;align-items:center;gap:.7rem;}
        .user-av{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent3));display:flex;align-items:center;justify-content:center;font-size:.9rem;flex-shrink:0;}
        .user-name{font-weight:600;}
        .user-email{font-size:.75rem;color:var(--text2);}
        .badge{display:inline-flex;align-items:center;gap:.3rem;padding:3px 9px;border-radius:20px;font-size:.72rem;font-weight:700;}
        .bg-green{background:rgba(16,185,129,.12);color:var(--green);border:1px solid rgba(16,185,129,.25);}
        .bg-red{background:rgba(239,68,68,.12);color:var(--red);border:1px solid rgba(239,68,68,.25);}
        .bg-blue{background:rgba(0,212,255,.12);color:var(--accent2);border:1px solid rgba(0,212,255,.25);}
        .bg-yellow{background:rgba(245,158,11,.12);color:var(--yellow);border:1px solid rgba(245,158,11,.25);}
        .bg-purple{background:rgba(124,58,237,.12);color:#a78bfa;border:1px solid rgba(124,58,237,.25);}
        .act-btns{display:flex;gap:.4rem;}
        .act-btn{padding:.28rem .6rem;border-radius:6px;font-size:.75rem;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:600;transition:all .2s;border:1px solid transparent;}
        .btn-view{background:rgba(0,212,255,.1);color:var(--accent2);border-color:rgba(0,212,255,.2);}
        .btn-view:hover{background:rgba(0,212,255,.2);}
        .btn-ban{background:rgba(239,68,68,.1);color:var(--red);border-color:rgba(239,68,68,.2);}
        .btn-ban:hover{background:rgba(239,68,68,.2);}
        .btn-unban{background:rgba(16,185,129,.1);color:var(--green);border-color:rgba(16,185,129,.2);}
        .btn-unban:hover{background:rgba(16,185,129,.2);}
        .btn-del{background:rgba(239,68,68,.1);color:var(--red);border-color:rgba(239,68,68,.2);}
        .btn-del:hover{background:rgba(239,68,68,.2);}

        /* ---- PAGINATION ---- */
        .pagination{display:flex;align-items:center;justify-content:space-between;padding:1rem 1.5rem;border-top:1px solid var(--border);}
        .pag-info{font-size:.8rem;color:var(--text2);}
        .pag-btns{display:flex;gap:.4rem;}
        .pag-btn{width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:6px;border:1px solid var(--border);cursor:pointer;font-size:.82rem;color:var(--text2);background:transparent;font-family:'DM Sans',sans-serif;transition:all .2s;}
        .pag-btn:hover,.pag-btn.active{background:var(--accent);border-color:var(--accent);color:#fff;}

        /* ---- FORMS ---- */
        .form-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:1.5rem;margin-bottom:1.5rem;}
        .form-card h3{font-size:1rem;font-weight:700;margin-bottom:1.2rem;}
        .fg{margin-bottom:1rem;}
        .fg label{display:block;font-size:.8rem;font-weight:600;color:var(--text2);margin-bottom:.4rem;}
        .fi,.fs,.fta{width:100%;padding:.75rem 1rem;background:rgba(255,255,255,.04);border:1px solid var(--border2);border-radius:10px;color:var(--text);font-size:.88rem;font-family:'DM Sans',sans-serif;outline:none;transition:all .25s;}
        .fi:focus,.fs:focus,.fta:focus{border-color:var(--accent);background:rgba(255,51,102,.04);box-shadow:0 0 0 3px rgba(255,51,102,.1);}
        .fta{resize:vertical;min-height:100px;}
        .fs option{background:var(--bg3);}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem;}
        .submit-btn{padding:.75rem 1.5rem;background:linear-gradient(135deg,var(--accent),#ff5580);border:none;border-radius:10px;color:#fff;font-size:.88rem;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;transition:all .25s;box-shadow:0 4px 20px rgba(255,51,102,.25);}
        .submit-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(255,51,102,.4);}

        /* ---- SETTINGS ---- */
        .settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;}
        .settings-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:1.5rem;}
        .settings-card h3{font-size:1rem;font-weight:700;margin-bottom:1.2rem;padding-bottom:.8rem;border-bottom:1px solid var(--border);}
        .toggle-row{display:flex;align-items:center;justify-content:space-between;padding:.6rem 0;border-bottom:1px solid var(--border);}
        .toggle-row:last-of-type{border-bottom:none;}
        .tl-text{font-size:.87rem;}
        .tl-desc{font-size:.75rem;color:var(--text2);margin-top:2px;}
        .toggle{width:42px;height:22px;background:var(--bg3);border:1px solid var(--border2);border-radius:11px;cursor:pointer;position:relative;transition:all .3s;flex-shrink:0;}
        .toggle::after{content:'';position:absolute;width:16px;height:16px;background:var(--text2);border-radius:50%;top:2px;left:2px;transition:all .3s;}
        .toggle.on{background:rgba(16,185,129,.2);border-color:rgba(16,185,129,.4);}
        .toggle.on::after{background:var(--green);left:22px;}

        /* ---- ACTIVITY ---- */
        .act-item{display:flex;align-items:flex-start;gap:1rem;padding:1rem;border-bottom:1px solid var(--border);}
        .act-item:last-child{border-bottom:none;}
        .act-dot{width:8px;height:8px;border-radius:50%;margin-top:6px;flex-shrink:0;}
        .act-text{font-size:.87rem;line-height:1.5;}
        .act-time{font-size:.75rem;color:var(--text2);margin-top:2px;}

        /* ---- MODAL ---- */
        .modal-ov{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);z-index:9000;display:none;align-items:center;justify-content:center;padding:1rem;}
        .modal-ov.open{display:flex;}
        .modal-box{background:var(--card);border:1px solid var(--border2);border-radius:16px;padding:2rem;width:100%;max-width:480px;box-shadow:0 40px 100px rgba(0,0,0,.5);}
        .modal-box h3{font-size:1.1rem;font-weight:700;margin-bottom:1.2rem;}
        .modal-actions{display:flex;gap:.7rem;justify-content:flex-end;margin-top:1.5rem;}
        .btn-cancel{padding:.65rem 1.2rem;background:rgba(255,255,255,.05);border:1px solid var(--border2);border-radius:8px;color:var(--text2);font-size:.85rem;font-family:'DM Sans',sans-serif;cursor:pointer;}
        .btn-confirm{padding:.65rem 1.2rem;background:rgba(239,68,68,.15);border:1px solid rgba(239,68,68,.3);border-radius:8px;color:var(--red);font-size:.85rem;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;}
        .btn-confirm:hover{background:rgba(239,68,68,.25);}
        .detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:.8rem;margin-bottom:1rem;}
        .detail-item label{color:var(--text2);display:block;font-size:.75rem;margin-bottom:2px;}

        /* ---- LOADING ---- */
        .loading-td td{text-align:center;padding:3rem;color:var(--text2);}
        .spinner{display:inline-block;width:18px;height:18px;border:2px solid rgba(255,255,255,.1);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;vertical-align:middle;margin-right:.5rem;}
        @keyframes spin{to{transform:rotate(360deg)}}

        /* ---- TOAST ---- */
        #toast{position:fixed;bottom:2rem;right:2rem;z-index:99999;display:flex;flex-direction:column;gap:.5rem;}
        .toast{background:var(--card2);border:1px solid var(--border2);border-radius:10px;padding:.8rem 1.2rem;font-size:.87rem;display:flex;align-items:center;gap:.6rem;box-shadow:0 10px 40px rgba(0,0,0,.4);animation:slideIn .3s ease;min-width:240px;}
        .toast.success{border-left:3px solid var(--green);}
        .toast.error{border-left:3px solid var(--red);}
        .toast.info{border-left:3px solid var(--accent2);}
        @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}

        .empty-state{text-align:center;padding:4rem 2rem;color:var(--text2);}
        .empty-state .ei{font-size:3rem;margin-bottom:1rem;}
        .empty-state h3{font-size:1.1rem;color:var(--text);margin-bottom:.5rem;}
        .mono{font-family:'JetBrains Mono',monospace;font-size:.82rem;}

        @media(max-width:1024px){.chart-grid-2,.chart-grid-eq,.settings-grid{grid-template-columns:1fr;}}
        @media(max-width:768px){#sidebar{transform:translateX(-100%);}#mainContent{margin-left:0;}.form-row{grid-template-columns:1fr;}}
    
        /* ===== BAN MODAL ===== */
        .ban-modal-overlay {
            position:fixed;inset:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(6px);
            z-index:9999;display:flex;align-items:center;justify-content:center;
            opacity:0;pointer-events:none;transition:opacity .25s;
        }
        .ban-modal-overlay.open { opacity:1;pointer-events:all; }
        .ban-modal {
            background:#111318;border:1px solid rgba(239,68,68,0.25);
            border-radius:20px;padding:2rem;width:100%;max-width:480px;
            box-shadow:0 25px 80px rgba(0,0,0,0.6),0 0 0 1px rgba(239,68,68,0.1);
            transform:scale(0.95) translateY(20px);transition:transform .25s;
            position:relative;
        }
        .ban-modal-overlay.open .ban-modal { transform:scale(1) translateY(0); }
        .ban-modal-header {
            display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;
        }
        .ban-modal-title {
            font-size:1.3rem;font-weight:900;color:#ef4444;
            display:flex;align-items:center;gap:0.5rem;
        }
        .ban-modal-close {
            width:32px;height:32px;border-radius:50%;border:1px solid rgba(255,255,255,0.1);
            background:rgba(255,255,255,0.05);color:var(--text2);cursor:pointer;
            font-size:1rem;display:flex;align-items:center;justify-content:center;
            transition:all .2s;
        }
        .ban-modal-close:hover { background:rgba(239,68,68,0.2);color:#ef4444;border-color:rgba(239,68,68,0.4); }
        .ban-user-card {
            display:flex;align-items:center;gap:1rem;
            background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.15);
            border-radius:12px;padding:1rem;margin-bottom:1.5rem;
        }
        .ban-user-av {
            width:46px;height:46px;border-radius:50%;
            background:linear-gradient(135deg,#ef4444,#7c3aed);
            display:flex;align-items:center;justify-content:center;font-size:1.4rem;flex-shrink:0;
        }
        .ban-user-name { font-weight:700;font-size:1rem;color:var(--text1); }
        .ban-user-sub  { font-size:0.78rem;color:var(--text2);margin-top:0.1rem; }
        .ban-field { margin-bottom:1.2rem; }
        .ban-field label {
            display:block;font-size:0.75rem;font-weight:700;letter-spacing:1px;
            text-transform:uppercase;color:var(--text2);margin-bottom:0.5rem;
        }
        .ban-field select,
        .ban-field textarea {
            width:100%;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);
            border-radius:10px;padding:0.75rem 1rem;color:var(--text1);font-family:'DM Sans',sans-serif;
            font-size:0.9rem;transition:border-color .2s;resize:none;
        }
        .ban-field select:focus,
        .ban-field textarea:focus { outline:none;border-color:rgba(239,68,68,0.5); }
        .ban-reason-chips { display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:0.7rem; }
        .ban-chip {
            background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);
            border-radius:20px;padding:0.25rem 0.7rem;font-size:0.78rem;color:var(--text2);
            cursor:pointer;transition:all .2s;
        }
        .ban-chip:hover,.ban-chip.active {
            background:rgba(239,68,68,0.15);border-color:rgba(239,68,68,0.4);color:#ef4444;
        }
        .ban-modal-actions { display:flex;gap:0.8rem;margin-top:1.5rem; }
        .btn-ban-confirm {
            flex:1;background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;
            border:none;border-radius:10px;padding:0.85rem;font-size:0.95rem;font-weight:700;
            cursor:pointer;transition:all .2s;font-family:'DM Sans',sans-serif;
        }
        .btn-ban-confirm:hover { transform:translateY(-1px);box-shadow:0 8px 25px rgba(239,68,68,0.4); }
        .btn-ban-cancel {
            flex:1;background:rgba(255,255,255,0.05);color:var(--text1);
            border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:0.85rem;
            font-size:0.95rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:'DM Sans',sans-serif;
        }
        .btn-ban-cancel:hover { background:rgba(255,255,255,0.09); }
        .ban-duration-row { display:grid;grid-template-columns:1fr 1fr;gap:0.8rem; }

        </style>
</head>
<body>

<!-- ========== LOGIN ========== -->
<div id="loginScreen">
    <div class="login-box">
        <div class="login-logo">
            <!-- Tobi Mask SVG (Naruto-style orange mask) -->
            <svg class="tobi-mask-svg" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <ellipse cx="20" cy="21" rx="17" ry="16" fill="#E8630A"/>
                <ellipse cx="20" cy="21" rx="17" ry="16" fill="url(#mg)"/>
                <!-- Swirl pattern -->
                <path d="M20 13 Q24 13 26 17 Q28 21 24 23 Q20 25 18 22 Q16 19 18 17 Q19 15 20 14" stroke="#fff" stroke-width="1.2" fill="none" stroke-linecap="round" opacity="0.6"/>
                <!-- Eye hole -->
                <ellipse cx="24" cy="18" rx="4" ry="4.5" fill="#1a0a00"/>
                <ellipse cx="24" cy="18" rx="4" ry="4.5" fill="url(#eg)" opacity="0.7"/>
                <!-- Eye shine -->
                <circle cx="25.5" cy="16.5" r="1.2" fill="rgba(255,255,255,0.5)"/>
                <!-- Mask outline -->
                <ellipse cx="20" cy="21" rx="17" ry="16" stroke="#c45500" stroke-width="1.5" fill="none"/>
                <!-- Chin detail -->
                <path d="M10 30 Q20 37 30 30" stroke="#c45500" stroke-width="1" fill="none" opacity="0.5"/>
                <defs>
                    <radialGradient id="mg" cx="35%" cy="30%">
                        <stop offset="0%" stop-color="#ff8c00" stop-opacity="0.6"/>
                        <stop offset="100%" stop-color="#E8630A" stop-opacity="0"/>
                    </radialGradient>
                    <radialGradient id="eg" cx="50%" cy="50%">
                        <stop offset="0%" stop-color="#ff3300" stop-opacity="0.4"/>
                        <stop offset="100%" stop-color="#000" stop-opacity="0"/>
                    </radialGradient>
                </defs>
            </svg>
            <span class="login-logo-text">TobiList</span>
        </div>
        <p class="login-sub">Admin Panel ‚Äî <span>RESTRICTED ACCESS</span></p>
        <div class="lf">
            <label>Email Address</label>
            <input type="email" id="adminEmail" placeholder="admin@tobilist.com" autocomplete="email">
        </div>
        <div class="lf">
            <label>Password</label>
            <input type="password" id="adminPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" onkeydown="if(event.key==='Enter')adminLogin()">
        </div>
        <div id="loginErr" class="login-err"></div>
        <button class="login-btn" id="loginBtn" onclick="adminLogin()">Sign In as Admin ‚Üí</button>
    </div>
</div>

<!-- ========== SIDEBAR ========== -->
<nav id="sidebar">
    <div class="sb-logo">
        <div class="sb-logo-row">
            <svg width="28" height="28" viewBox="0 0 40 40" fill="none">
                <ellipse cx="20" cy="21" rx="17" ry="16" fill="#E8630A"/>
                <path d="M20 13 Q24 13 26 17 Q28 21 24 23 Q20 25 18 22 Q16 19 18 17 Q19 15 20 14" stroke="#fff" stroke-width="1.2" fill="none" stroke-linecap="round" opacity="0.6"/>
                <ellipse cx="24" cy="18" rx="4" ry="4.5" fill="#1a0a00"/>
                <circle cx="25.5" cy="16.5" r="1.2" fill="rgba(255,255,255,0.5)"/>
                <ellipse cx="20" cy="21" rx="17" ry="16" stroke="#c45500" stroke-width="1.5" fill="none"/>
            </svg>
            <div class="sb-logo-text">TobiList</div>
        </div>
        <div class="sb-sub">Admin Dashboard</div>
    </div>
    <div class="sb-nav">
        <div class="sb-section">Overview</div>
        <div class="nav-item active" onclick="showPage('dashboard')"><span class="nav-icon">üìä</span> Dashboard</div>
        <div class="nav-item" onclick="showPage('analytics')"><span class="nav-icon">üìà</span> Analytics</div>
        <div class="sb-section">Users</div>
        <div class="nav-item" onclick="showPage('users')"><span class="nav-icon">üë•</span> All Users <span class="nav-badge" id="userCountBadge">0</span></div>
        <div class="nav-item" onclick="showPage('bans')"><span class="nav-icon">üö´</span> Banned Users</div>
        <div class="sb-section">Content</div>
        <div class="nav-item" onclick="showPage('content')"><span class="nav-icon">üé¨</span> Content Entries</div>
        <div class="nav-item" onclick="showPage('announcements')"><span class="nav-icon">üì¢</span> Announcements</div>
        <div class="sb-section">System</div>
        <div class="nav-item" onclick="showPage('logs')"><span class="nav-icon">üìã</span> Activity Log</div>
        <div class="nav-item" onclick="showPage('settings')"><span class="nav-icon">‚öôÔ∏è</span> Settings</div>
    </div>
    <div class="sb-footer">
        <div class="admin-info">
            <div class="admin-av">üëë</div>
            <div><div class="admin-name" id="adminNameEl">Admin</div><div class="admin-role">Super Admin</div></div>
        </div>
        <button class="logout-btn" onclick="adminLogout()">üö™ Sign Out</button>
    </div>
</nav>

<!-- ========== MAIN ========== -->
<div id="mainContent">
    <div class="top-bar">
        <div class="page-title-bar">
            <h1 id="pageTitle">Dashboard</h1>
            <p id="pageSub">TobiList platform overview</p>
        </div>
        <div class="top-actions">
            <div class="live-badge"><div class="live-dot"></div><span>Live</span></div>
            <button class="refresh-btn" onclick="refreshCurrent()">üîÑ Refresh</button>
            <span id="lastUpdated" style="font-size:.75rem;color:var(--text3);"></span>
        </div>
    </div>

    <!-- DASHBOARD -->
    <div class="page active" id="page-dashboard">
        <div class="stat-grid">
            <div class="stat-card c-blue"><div class="stat-icon">üë•</div><div class="stat-label">Total Users</div><div class="stat-value" id="s-total-users">‚Äî</div><div class="stat-change up" id="s-users-change">Loading‚Ä¶</div></div>
            <div class="stat-card c-green"><div class="stat-icon">üü¢</div><div class="stat-label">Active (7d)</div><div class="stat-value" id="s-active">‚Äî</div><div class="stat-change">Recent activity</div></div>
            <div class="stat-card c-pink"><div class="stat-icon">üé¨</div><div class="stat-label">Total Entries</div><div class="stat-value" id="s-entries">‚Äî</div><div class="stat-change">User additions</div></div>
            <div class="stat-card c-purple"><div class="stat-icon">‚≠ê</div><div class="stat-label">XP Distributed</div><div class="stat-value" id="s-xp">‚Äî</div><div class="stat-change">All time</div></div>
            <div class="stat-card c-yellow"><div class="stat-icon">‚úÖ</div><div class="stat-label">Completed</div><div class="stat-value" id="s-completed">‚Äî</div><div class="stat-change">Entries</div></div>
        </div>
        <div class="chart-grid-2">
            <div class="chart-card">
                <h3>User Activity</h3><p>Daily activity (last 7 days)</p>
                <canvas id="chartUsers" height="200"></canvas>
            </div>
            <div class="chart-card">
                <h3>Content Types</h3><p>Breakdown by category</p>
                <canvas id="chartContent" height="200"></canvas>
            </div>
        </div>
        <div class="table-card">
            <div class="table-header"><h3>üÜï Recently Active Users</h3><button class="tbl-btn" onclick="showPage('users')">View All ‚Üí</button></div>
            <table><thead><tr><th>User</th><th>Last Active</th><th>Entries</th><th>Status</th></tr></thead>
            <tbody id="recentUsersBody"><tr class="loading-td"><td colspan="4"><span class="spinner"></span>Loading‚Ä¶</td></tr></tbody></table>
        </div>
    </div>

    <!-- ANALYTICS -->
    <div class="page" id="page-analytics">
        <div class="stat-grid">
            <div class="stat-card c-pink"><div class="stat-icon">üî•</div><div class="stat-label">Avg. Streak</div><div class="stat-value" id="a-streak">‚Äî</div><div class="stat-change">days/user</div></div>
            <div class="stat-card c-blue"><div class="stat-icon">üìä</div><div class="stat-label">Avg. List Size</div><div class="stat-value" id="a-list">‚Äî</div><div class="stat-change">entries/user</div></div>
            <div class="stat-card c-green"><div class="stat-icon">‚≠ê</div><div class="stat-label">Avg. Rating</div><div class="stat-value" id="a-rating">‚Äî</div><div class="stat-change">out of 5</div></div>
            <div class="stat-card c-purple"><div class="stat-icon">üèÜ</div><div class="stat-label">Avg. Level</div><div class="stat-value" id="a-level">‚Äî</div><div class="stat-change">per user</div></div>
        </div>
        <div class="chart-grid-eq">
            <div class="chart-card"><h3>Genre Distribution</h3><p>Most popular genres</p><canvas id="chartGenre" height="260"></canvas></div>
            <div class="chart-card"><h3>Watch Status</h3><p>Overall status breakdown</p><canvas id="chartStatus" height="260"></canvas></div>
        </div>
        <div class="table-card">
            <div class="table-header"><h3>üèÜ Top Users by XP</h3></div>
            <table><thead><tr><th>#</th><th>User</th><th>XP</th><th>Level</th><th>Entries</th><th>Streak</th></tr></thead>
            <tbody id="topUsersBody"><tr class="loading-td"><td colspan="6"><span class="spinner"></span>Loading‚Ä¶</td></tr></tbody></table>
        </div>
    </div>

    <!-- USERS -->
    <div class="page" id="page-users">
        <div class="table-card">
            <div class="table-header">
                <h3>üë• All Users</h3>
                <div class="table-actions">
                    <input class="search-inp" type="text" id="userSearch" placeholder="üîç Search users‚Ä¶" oninput="filterUsers()">
                    <select class="fi" style="width:auto;padding:.38rem .8rem;" id="userSort" onchange="loadUsers()">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="xp">By XP</option>
                    </select>
                    <button class="tbl-btn" onclick="exportCSV()">üì• Export CSV</button>
                </div>
            </div>
            <table><thead><tr><th>User</th><th>Email</th><th>Joined</th><th>XP</th><th>Entries</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody id="usersBody"><tr class="loading-td"><td colspan="7"><span class="spinner"></span>Loading‚Ä¶</td></tr></tbody></table>
            <div class="pagination"><div class="pag-info" id="usersPageInfo">‚Äî</div><div class="pag-btns" id="usersPageBtns"></div></div>
        </div>
    </div>

    <!-- BANS -->
    <div class="page" id="page-bans">
        <div class="table-card">
            <div class="table-header"><h3>üö´ Banned Users</h3></div>
            <table><thead><tr><th>User</th><th>Banned</th><th>Reason</th><th>Actions</th></tr></thead>
            <tbody id="bansBody"><tr class="loading-td"><td colspan="4"><span class="spinner"></span>Loading‚Ä¶</td></tr></tbody></table>
        </div>
    </div>

    <!-- CONTENT -->
    <div class="page" id="page-content">
        <div class="table-card">
            <div class="table-header">
                <h3>üé¨ Content Entries</h3>
                <div class="table-actions">
                    <input class="search-inp" type="text" id="contentSearch" placeholder="üîç Search‚Ä¶" oninput="filterContent()">
                    <select class="fi" style="width:auto;padding:.38rem .8rem;" id="contentTypeF" onchange="loadContent()">
                        <option value="all">All Types</option>
                        <option value="anime">Anime</option>
                        <option value="manga">Manga</option>
                        <option value="webtoon">Webtoon</option>
                    </select>
                </div>
            </div>
            <table><thead><tr><th>Title</th><th>Type</th><th>User</th><th>Status</th><th>Rating</th><th>Added</th></tr></thead>
            <tbody id="contentBody"><tr class="loading-td"><td colspan="6"><span class="spinner"></span>Loading‚Ä¶</td></tr></tbody></table>
            <div class="pagination"><div class="pag-info" id="contentPageInfo">‚Äî</div><div class="pag-btns" id="contentPageBtns"></div></div>
        </div>
    </div>

    <!-- ANNOUNCEMENTS -->
    <div class="page" id="page-announcements">
        <div class="form-card">
            <h3>üì¢ Send New Announcement</h3>
            <div class="form-row">
                <div class="fg"><label>Title</label><input type="text" class="fi" id="annTitle" placeholder="Announcement title‚Ä¶"></div>
                <div class="fg"><label>Type</label>
                    <select class="fs" id="annType">
                        <option value="info">‚ÑπÔ∏è Info</option>
                        <option value="success">‚úÖ Success</option>
                        <option value="warning">‚ö†Ô∏è Warning</option>
                        <option value="update">üöÄ Update</option>
                    </select>
                </div>
            </div>
            <div class="fg"><label>Message</label><textarea class="fta" id="annContent" placeholder="Write your announcement‚Ä¶"></textarea></div>
            <div class="form-row">
                <div class="fg"><label>Target</label>
                    <select class="fs" id="annTarget"><option value="all">All Users</option><option value="registered">Registered Only</option></select>
                </div>
                <div class="fg"><label>Priority</label>
                    <select class="fs" id="annPriority"><option value="normal">Normal</option><option value="high">High</option><option value="critical">Critical</option></select>
                </div>
            </div>
            <button class="submit-btn" onclick="sendAnnouncement()">üì¢ Publish Announcement</button>
        </div>
        <div class="table-card">
            <div class="table-header"><h3>üìú Announcement History</h3></div>
            <table><thead><tr><th>Title</th><th>Type</th><th>Date</th><th>Actions</th></tr></thead>
            <tbody id="annBody"><tr class="loading-td"><td colspan="4"><span class="spinner"></span>Loading‚Ä¶</td></tr></tbody></table>
        </div>
    </div>

    <!-- LOGS -->
    <div class="page" id="page-logs">
        <div class="table-card">
            <div class="table-header"><h3>üìã Activity Log</h3>
                <div class="table-actions">
                    <select class="fi" style="width:auto;padding:.38rem .8rem;" id="logFilter" onchange="loadLogs()">
                        <option value="all">All Events</option>
                        <option value="recent">Last 24h</option>
                    </select>
                </div>
            </div>
            <div id="logList" style="max-height:600px;overflow-y:auto;"></div>
        </div>
    </div>

    <!-- SETTINGS -->
    <div class="page" id="page-settings">
        <div class="settings-grid">
            <div class="settings-card">
                <h3>üîß Site Features</h3>
                <div class="toggle-row"><div><div class="tl-text">Open Registration</div><div class="tl-desc">Allow new user signups</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
                <div class="toggle-row"><div><div class="tl-text">Maintenance Mode</div><div class="tl-desc">Temporarily disable site</div></div><div class="toggle" onclick="this.classList.toggle('on')"></div></div>
                <div class="toggle-row"><div><div class="tl-text">Guest Browsing</div><div class="tl-desc">Allow non-registered users</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
                <div class="toggle-row"><div><div class="tl-text">AI Recommendations</div><div class="tl-desc">Enable AI section</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
            </div>
            <div class="settings-card">
                <h3>üîî Notifications</h3>
                <div class="toggle-row"><div><div class="tl-text">Email Notifications</div><div class="tl-desc">Send welcome / reset emails</div></div><div class="toggle" onclick="this.classList.toggle('on')"></div></div>
                <div class="toggle-row"><div><div class="tl-text">Push Notifications</div><div class="tl-desc">Browser push alerts</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
                <div class="toggle-row"><div><div class="tl-text">Streak Warnings</div><div class="tl-desc">Alert before streak loss</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
            </div>
            <div class="settings-card">
                <h3>üõ°Ô∏è Security</h3>
                <div class="fg"><label>New Admin Password</label><input type="password" class="fi" id="newPw" placeholder="New password‚Ä¶"></div>
                <div class="fg"><label>Confirm Password</label><input type="password" class="fi" id="confirmPw" placeholder="Confirm‚Ä¶"></div>
                <button class="submit-btn" style="padding:.6rem 1.2rem;font-size:.85rem;" onclick="changePassword()">Update Password</button>
            </div>
            <div class="settings-card">
                <h3>üì° Supabase Status</h3>
                <div class="fg"><label>Project URL</label><input type="text" class="fi mono" id="supaUrlEl" readonly></div>
                <div class="fg"><label>Connection</label><div id="supaStatus" class="badge bg-yellow" style="display:inline-flex;">‚è≥ Checking‚Ä¶</div></div>
                <div class="fg" style="margin-top:1rem;"><label>Quick Stats</label><div id="supaStats" style="font-size:.83rem;color:var(--text2);line-height:1.9;">‚Äî</div></div>
            </div>
        </div>
    </div>
</div>

<!-- CONFIRM MODAL -->
<div class="modal-ov" id="confirmModal">
    <div class="modal-box">
        <h3 id="confirmTitle">Are you sure?</h3>
        <p id="confirmText" style="color:var(--text2);font-size:.87rem;line-height:1.6;"></p>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeConfirm()">Cancel</button>
            <button class="btn-confirm" id="confirmBtn">Confirm</button>
        </div>
    </div>
</div>

<!-- USER DETAIL MODAL -->
<div class="modal-ov" id="userModal">
    <div class="modal-box" style="max-width:560px;">
        <h3>üë§ User Details</h3>
        <div id="userModalContent" style="margin-top:1rem;"></div>
        <div class="modal-actions"><button class="btn-cancel" onclick="closeModal('userModal')">Close</button></div>
    </div>
</div>

<div id="toast"></div>

<script>
// ===== CONFIG =====
const SUPABASE_URL  = 'https://qhfjpuwduuxzojurngte.supabase.co';
const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFoZmpwdXdkdXV4em9qdXJuZ3RlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NzU1MTksImV4cCI6MjA4NzI1MTUxOX0.lgtxEwGFW07P1vY9Soid2s_sM47jODk_nsUECznHSFA';
// ‚¨á Add YOUR Supabase-registered email here
const ADMIN_EMAILS  = ['list086@gmail.com'];

let sb, currentAdmin = null, curPage = 'dashboard';
let allUsers = [], allContent = [];
let usersPage = 1, contentPage = 1;
const PER_PAGE = 20;

// chart instances
const charts = {};

// ===== BOOT =====
window.onload = async () => {
    sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
    try {
        const { data: { session } } = await sb.auth.getSession();
        if (session?.user && isAdmin(session.user.email)) {
            currentAdmin = session.user;
            boot();
        }
    } catch(e) { console.warn(e); }
};

function isAdmin(email) {
    return ADMIN_EMAILS.map(e=>e.toLowerCase()).includes((email||'').toLowerCase());
}

function boot() {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('mainContent').style.display = 'block';
    document.getElementById('adminNameEl').textContent = currentAdmin.email.split('@')[0];
    document.getElementById('supaUrlEl').value = SUPABASE_URL;
    checkSupabase();
    loadDashboard();
}

// ===== LOGIN =====
async function adminLogin() {
    const email = document.getElementById('adminEmail').value.trim();
    const pw    = document.getElementById('adminPassword').value;
    const errEl = document.getElementById('loginErr');
    errEl.style.display = 'none';

    if (!email || !pw) { showErr('Email and password required.'); return; }
    if (!isAdmin(email)) { showErr('This account does not have admin access.'); return; }

    const btn = document.getElementById('loginBtn');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span>Signing in‚Ä¶';

    try {
        const { data, error } = await sb.auth.signInWithPassword({ email, password: pw });
        if (error) throw error;
        if (!data?.user || !isAdmin(data.user.email)) throw new Error('Not an admin account.');
        currentAdmin = data.user;
        boot();
    } catch(e) {
        btn.disabled = false;
        btn.textContent = 'Sign In as Admin ‚Üí';
        showErr(e.message || 'Login failed.');
    }
}

function showErr(msg) {
    const el = document.getElementById('loginErr');
    el.textContent = msg;
    el.style.display = 'block';
}

async function adminLogout() {
    await sb.auth.signOut();
    location.reload();
}

// ===== NAVIGATION =====
const PAGE_META = {
    dashboard:     ['Dashboard',         'Platform overview'],
    analytics:     ['Analytics',         'In-depth insights'],
    users:         ['All Users',         'Manage registered accounts'],
    bans:          ['Banned Users',      'Manage banned accounts'],
    content:       ['Content Entries',   'All user-added items'],
    announcements: ['Announcements',     'Broadcast to users'],
    logs:          ['Activity Log',      'System event history'],
    settings:      ['Settings',          'Site configuration'],
};

function showPage(page) {
    document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.textContent.trim().toLowerCase().includes(page) || (n.getAttribute('onclick')||'').includes(`'${page}'`)));
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-' + page)?.classList.add('active');
    curPage = page;

    const [title, sub] = PAGE_META[page] || ['‚Äî',''];
    document.getElementById('pageTitle').textContent = title;
    document.getElementById('pageSub').textContent   = sub;
    document.getElementById('lastUpdated').textContent = 'Updated: ' + new Date().toLocaleTimeString('en-US');

    const loaders = {
        dashboard: loadDashboard, analytics: loadAnalytics,
        users: loadUsers, bans: loadBans, content: loadContent,
        announcements: loadAnnouncements, logs: loadLogs, settings: ()=>{}
    };
    loaders[page]?.();
}

function refreshCurrent() { showPage(curPage); }

// ===== DASHBOARD =====
async function loadDashboard() {
    const { data: rows, error } = await sb.from('user_data')
        .select('user_id,data,updated_at')
        .order('updated_at', { ascending: false });

    if (error) { toast('Load error: ' + error.message, 'error'); return; }
    const users = rows || [];

    document.getElementById('s-total-users').textContent = users.length;
    document.getElementById('userCountBadge').textContent = users.length;
    document.getElementById('s-users-change').textContent = `‚¨Ü ${users.length} total registered`;

    const ago7 = new Date(Date.now() - 7*864e5).toISOString();
    document.getElementById('s-active').textContent = users.filter(u => u.updated_at > ago7).length;

    let entries = 0, xpTotal = 0, completed = 0, anime = 0, manga = 0, webtoon = 0;
    users.forEach(u => {
        const d = u.data;
        if (d?.items) {
            entries  += d.items.length;
            completed+= d.items.filter(i=>i.status==='completed').length;
            anime    += d.items.filter(i=>i.type==='anime').length;
            manga    += d.items.filter(i=>i.type==='manga').length;
            webtoon  += d.items.filter(i=>i.type==='webtoon').length;
        }
        if (d?.xp?.total) xpTotal += d.xp.total;
    });

    document.getElementById('s-entries').textContent   = entries;
    document.getElementById('s-xp').textContent        = xpTotal.toLocaleString('en-US');
    document.getElementById('s-completed').textContent = completed;

    // Charts
    drawLineChart('chartUsers', buildDailyActivity(users));
    drawDonut('chartContent', ['Anime','Manga','Webtoon'], [anime,manga,webtoon], ['#ff3366','#00d4ff','#7c3aed']);

    // Recent table
    const tbody = document.getElementById('recentUsersBody');
    const recent = users.slice(0, 8);
    if (!recent.length) { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:2rem;color:var(--text2);">No users yet</td></tr>'; return; }
    tbody.innerHTML = recent.map(u => {
        const d = u.data;
        const name = d?.social?.name || u.user_id.substring(0,8)+'‚Ä¶';
        return `<tr>
            <td><div class="user-cell"><div class="user-av">${d?.social?.avatar||'üë§'}</div>
            <div><div class="user-name">${name}</div><div class="user-email mono">${u.user_id.substring(0,14)}‚Ä¶</div></div></div></td>
            <td style="color:var(--text2);font-size:.82rem;">${fmtDate(u.updated_at)}</td>
            <td>${d?.items?.length||0}</td>
            <td>${d?.banned?'<span class="badge bg-red">üö´ Banned</span>':'<span class="badge bg-green">‚úÖ Active</span>'}</td>
        </tr>`;
    }).join('');
}

function buildDailyActivity(users) {
    const labels=[], data=[];
    for (let i=6;i>=0;i--) {
        const d = new Date(Date.now()-i*864e5);
        labels.push(d.toLocaleDateString('en-US',{weekday:'short'}));
        const ds = d.toISOString().split('T')[0];
        data.push(users.filter(u=>u.updated_at?.startsWith(ds)).length);
    }
    return { labels, data };
}

// ===== ANALYTICS =====
async function loadAnalytics() {
    const { data: rows } = await sb.from('user_data').select('data');
    if (!rows) return;

    let streakSum=0, listSum=0, ratingSum=0, ratingN=0, levelSum=0;
    const genres={}, statuses={};

    rows.forEach(r => {
        const d=r.data;
        if (d?.streak?.count) streakSum+=d.streak.count;
        if (d?.items) {
            listSum+=d.items.length;
            d.items.forEach(i => {
                if (i.rating){ ratingSum+=i.rating; ratingN++; }
                if (i.genre) genres[i.genre]=(genres[i.genre]||0)+1;
                if (i.status) statuses[i.status]=(statuses[i.status]||0)+1;
            });
        }
        if (d?.xp?.level) levelSum+=d.xp.level;
    });

    const n = rows.length||1;
    document.getElementById('a-streak').textContent = (streakSum/n).toFixed(1);
    document.getElementById('a-list').textContent   = (listSum/n).toFixed(1);
    document.getElementById('a-rating').textContent = ratingN?(ratingSum/ratingN).toFixed(1):'0';
    document.getElementById('a-level').textContent  = (levelSum/n).toFixed(1);

    const gL = Object.keys(genres).slice(0,8);
    drawBar('chartGenre', gL, gL.map(g=>genres[g]));

    const sMap = {watching:'‚ñ∂ Watching',completed:'‚úÖ Completed',plantowatch:'üìã Plan',onhold:'‚è∏ On Hold',dropped:'‚ùå Dropped'};
    const sL = Object.keys(statuses);
    drawDonut('chartStatus', sL.map(k=>sMap[k]||k), sL.map(k=>statuses[k]), ['#00d4ff','#10b981','#7c3aed','#f59e0b','#ef4444']);

    // Top users
    const sorted = rows.map(r=>r.data).sort((a,b)=>(b?.xp?.total||0)-(a?.xp?.total||0)).slice(0,10);
    document.getElementById('topUsersBody').innerHTML = sorted.map((d,i)=>`<tr>
        <td><strong>#${i+1}</strong></td>
        <td><div class="user-cell"><div class="user-av">${d?.social?.avatar||'üë§'}</div><div class="user-name">${d?.social?.name||'User'}</div></div></td>
        <td><strong style="color:var(--yellow)">${(d?.xp?.total||0).toLocaleString()}</strong></td>
        <td><span class="badge bg-purple">Lv.${d?.xp?.level||1}</span></td>
        <td>${d?.items?.length||0}</td>
        <td>üî•${d?.streak?.count||0}</td>
    </tr>`).join('');
}

// ===== USERS =====
async function loadUsers() {
    document.getElementById('usersBody').innerHTML = '<tr class="loading-td"><td colspan="7"><span class="spinner"></span>Loading‚Ä¶</td></tr>';
    const { data, error } = await sb.from('user_data').select('user_id,data,updated_at').order('updated_at',{ascending:false});
    if (error) { toast('Error: '+error.message,'error'); return; }
    allUsers = data||[];
    usersPage=1;
    renderUsers();
}

function renderUsers() {
    const q = (document.getElementById('userSearch')?.value||'').toLowerCase();
    let filtered = allUsers;
    if (q) filtered = filtered.filter(u => {
        const n=(u.data?.social?.name||'').toLowerCase();
        const e=(u.data?.social?.email||'').toLowerCase();
        return n.includes(q)||e.includes(q)||u.user_id.includes(q);
    });

    const total=filtered.length, pages=Math.ceil(total/PER_PAGE)||1;
    const slice=filtered.slice((usersPage-1)*PER_PAGE, usersPage*PER_PAGE);

    document.getElementById('usersPageInfo').textContent = `${total} users ‚Ä¢ Page ${usersPage}/${pages}`;
    renderPag('usersPageBtns', pages, usersPage, p=>{ usersPage=p; renderUsers(); });

    const tbody = document.getElementById('usersBody');
    if (!slice.length) { tbody.innerHTML='<tr><td colspan="7"><div class="empty-state"><div class="ei">üë§</div><h3>No users found</h3></div></td></tr>'; return; }
    tbody.innerHTML = slice.map(u => {
        const d=u.data, banned=d?.banned;
        const name=d?.social?.name||'User';
        return `<tr>
            <td><div class="user-cell"><div class="user-av">${d?.social?.avatar||'üë§'}</div>
            <div><div class="user-name">${esc(name)}</div><div class="user-email mono">${u.user_id.substring(0,12)}‚Ä¶</div></div></div></td>
            <td style="color:var(--text2);font-size:.82rem;">${esc(d?.social?.email||'‚Äî')}</td>
            <td style="color:var(--text2);font-size:.82rem;">${fmtDate(u.updated_at)}</td>
            <td><strong style="color:var(--yellow)">${(d?.xp?.total||0).toLocaleString()}</strong></td>
            <td>${d?.items?.length||0}</td>
            <td>${banned?'<span class="badge bg-red">üö´ Banned</span>':'<span class="badge bg-green">‚úÖ Active</span>'}</td>
            <td><div class="act-btns">
                <button class="act-btn btn-view" onclick='viewUser(${JSON.stringify({uid:u.user_id,data:u.data})})'>üëÅ View</button>
                ${banned
                    ? `<button class="act-btn btn-unban" onclick="setBan('${u.user_id}',false,'${esc(name)}')">‚úÖ Unban</button>`
                    : `<button class="act-btn btn-ban"   onclick="confirmBan('${u.user_id}','${esc(name)}')">üö´ Ban</button>`}
            </div></td>
        </tr>`;
    }).join('');
}

function filterUsers() { usersPage=1; renderUsers(); }

function viewUser(u) {
    const d=u.data;
    document.getElementById('userModalContent').innerHTML = `
        <div class="detail-grid">
            <div class="detail-item"><label>Username</label><strong>${esc(d?.social?.name||'‚Äî')}</strong></div>
            <div class="detail-item"><label>Email</label><strong style="font-size:.82rem;">${esc(d?.social?.email||'‚Äî')}</strong></div>
            <div class="detail-item"><label>Level</label><strong>Lv.${d?.xp?.level||1}</strong></div>
            <div class="detail-item"><label>Total XP</label><strong style="color:var(--yellow)">${(d?.xp?.total||0).toLocaleString()}</strong></div>
            <div class="detail-item"><label>Entries</label><strong>${d?.items?.length||0}</strong></div>
            <div class="detail-item"><label>Completed</label><strong>${d?.items?.filter(i=>i.status==='completed').length||0}</strong></div>
            <div class="detail-item"><label>Streak</label><strong>üî• ${d?.streak?.count||0} days</strong></div>
            <div class="detail-item"><label>Achievements</label><strong>üèÜ ${d?.achievements?.length||0}</strong></div>
        </div>
        <div><label class="fg" style="display:block;margin-bottom:.3rem;">User ID</label>
        <div class="mono" style="background:var(--bg3);padding:.5rem .8rem;border-radius:6px;font-size:.78rem;word-break:break-all;">${u.uid}</div></div>`;
    openModal('userModal');
}

// Ban modal state
let _banUid = null;
let _banName = null;

function confirmBan(uid, name) {
    _banUid = uid;
    _banName = name;
    document.getElementById('banTargetName').textContent = name;
    document.getElementById('banTargetId').textContent = uid.substring(0,16) + '‚Ä¶';
    document.getElementById('banReasonInput').value = '';
    document.getElementById('banDuration').value = 'permanent';
    document.querySelectorAll('.ban-chip').forEach(c => c.classList.remove('active'));
    document.getElementById('banModalOverlay').classList.add('open');
}

function closeBanModal(e) {
    if (e && e.target !== document.getElementById('banModalOverlay')) return;
    document.getElementById('banModalOverlay').classList.remove('open');
}

function selectChip(el, reason) {
    document.querySelectorAll('.ban-chip').forEach(c => c.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('banReasonInput').value = reason;
}

async function executeBan() {
    const reason = document.getElementById('banReasonInput').value.trim() || 'Kural ihlali';
    const duration = document.getElementById('banDuration').value;
    document.getElementById('banModalOverlay').classList.remove('open');
    await setBan(_banUid, true, _banName, reason, duration);
}

async function setBan(uid, ban, name, reason='Kural ihlali', duration='permanent') {
    const { data: row, error } = await sb.from('user_data').select('data').eq('user_id',uid).single();
    if (error||!row) { toast('Kullanƒ±cƒ± bulunamadƒ±','error'); return; }
    const banExpiry = duration === 'permanent' ? null : new Date(Date.now() + parseInt(duration)*86400000).toISOString();
    const newData = { ...row.data, banned: ban, ban_reason: ban ? reason : null, ban_expiry: ban ? banExpiry : null, ban_date: ban ? new Date().toISOString() : null };
    const { error: e2 } = await sb.from('user_data')
        .update({ data: newData, updated_at: new Date().toISOString() })
        .eq('user_id', uid);
    if (e2) { toast('G√ºncelleme hatasƒ±: '+e2.message,'error'); return; }
    toast(ban ? `üö´ ${name} banlandƒ±` : `‚úÖ ${name} ban kaldƒ±rƒ±ldƒ±`, ban?'error':'success');
    loadUsers();
    if (!ban) loadBans();
}

function exportCSV() {
    const rows=[['UserID','Name','Email','Level','XP','Entries','Streak','Status']];
    allUsers.forEach(u=>{
        const d=u.data;
        rows.push([u.user_id, d?.social?.name||'', d?.social?.email||'', d?.xp?.level||1, d?.xp?.total||0, d?.items?.length||0, d?.streak?.count||0, d?.banned?'Banned':'Active']);
    });
    const blob = new Blob([rows.map(r=>r.join(',')).join('\n')],{type:'text/csv'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='tobilist_users_'+new Date().toISOString().split('T')[0]+'.csv';
    a.click();
    toast('üì• CSV exported','success');
}

// ===== BANS =====
async function loadBans() {
    const { data } = await sb.from('user_data').select('user_id,data,updated_at');
    const banned = (data||[]).filter(u=>u.data?.banned);
    const tbody  = document.getElementById('bansBody');
    if (!banned.length) {
        tbody.innerHTML='<tr><td colspan="4"><div class="empty-state"><div class="ei">‚úÖ</div><h3>No banned users</h3><p>All users are in good standing.</p></div></td></tr>';
        return;
    }
    tbody.innerHTML = banned.map(u=>{
        const d=u.data, name=esc(d?.social?.name||'User');
        const reason=d?.ban_reason||'Kural ihlali';
        const expiry=d?.ban_expiry ? `<span style="color:var(--text2);font-size:0.8rem;">‚è± ${fmtDate(d.ban_expiry)}'e kadar</span>` : '<span class="badge bg-red">‚ôæÔ∏è Kalƒ±cƒ±</span>';
        return `<tr>
        <td><div class="user-cell"><div class="user-av">üö´</div>
        <div><div class="user-name">${name}</div><div class="user-email mono">${u.user_id.substring(0,12)}‚Ä¶</div></div></div></td>
        <td style="color:var(--text2);">${fmtDate(u.updated_at)}</td>
        <td><div style="display:flex;flex-direction:column;gap:0.25rem;"><span class="badge bg-red">${esc(reason)}</span>${expiry}</div></td>
        <td><button class="act-btn btn-unban" onclick="setBan('${u.user_id}',false,'${name}')">‚úÖ Banƒ± Kaldƒ±r</button></td>
    </tr>`;}).join('');
}

// ===== CONTENT =====
async function loadContent() {
    document.getElementById('contentBody').innerHTML='<tr class="loading-td"><td colspan="6"><span class="spinner"></span>Loading‚Ä¶</td></tr>';
    const { data } = await sb.from('user_data').select('user_id,data');
    const typeF = document.getElementById('contentTypeF')?.value||'all';
    allContent=[];
    (data||[]).forEach(u=>{
        (u.data?.items||[]).forEach(item=>{
            if (typeF==='all'||item.type===typeF)
                allContent.push({...item, _uid:u.user_id, _uname:u.data?.social?.name||'User'});
        });
    });
    contentPage=1;
    renderContent();
}

function renderContent() {
    const q=(document.getElementById('contentSearch')?.value||'').toLowerCase();
    let filtered=allContent;
    if (q) filtered=filtered.filter(i=>(i.name||'').toLowerCase().includes(q));

    const total=filtered.length, pages=Math.ceil(total/PER_PAGE)||1;
    const slice=filtered.slice((contentPage-1)*PER_PAGE, contentPage*PER_PAGE);

    document.getElementById('contentPageInfo').textContent=`${total} entries`;
    renderPag('contentPageBtns', pages, contentPage, p=>{ contentPage=p; renderContent(); });

    const tb={'anime':'bg-red','manga':'bg-blue','webtoon':'bg-purple'};
    const sm={watching:'<span class="badge bg-blue">‚ñ∂ Watching</span>',completed:'<span class="badge bg-green">‚úÖ Completed</span>',plantowatch:'<span class="badge bg-purple">üìã Plan</span>',onhold:'<span class="badge bg-yellow">‚è∏ Hold</span>',dropped:'<span class="badge bg-red">‚ùå Dropped</span>'};

    const tbody=document.getElementById('contentBody');
    if (!slice.length){tbody.innerHTML='<tr><td colspan="6"><div class="empty-state"><div class="ei">üé¨</div><h3>No content found</h3></div></td></tr>';return;}
    tbody.innerHTML=slice.map(i=>`<tr>
        <td><strong>${esc(i.name||'‚Äî')}</strong></td>
        <td><span class="badge ${tb[i.type]||'bg-blue'}">${i.type}</span></td>
        <td style="color:var(--text2);font-size:.82rem;">${esc(i._uname)}</td>
        <td>${sm[i.status]||i.status}</td>
        <td>${i.rating?'‚≠ê'.repeat(Math.min(i.rating,5)):'‚Äî'}</td>
        <td style="color:var(--text2);font-size:.82rem;">${i.addedDate?fmtDate(i.addedDate):'‚Äî'}</td>
    </tr>`).join('');
}

function filterContent(){contentPage=1;renderContent();}

// ===== ANNOUNCEMENTS =====
async function loadAnnouncements() {
    const { data } = await sb.from('announcements').select('*').order('created_at',{ascending:false}).catch(()=>({data:[]}));
    const tbody=document.getElementById('annBody');
    if (!data?.length){tbody.innerHTML='<tr><td colspan="4"><div class="empty-state"><div class="ei">üì¢</div><h3>No announcements yet</h3></div></td></tr>';return;}
    const bm={'info':'bg-blue','success':'bg-green','warning':'bg-yellow','update':'bg-purple'};
    tbody.innerHTML=data.map(a=>`<tr>
        <td><strong>${esc(a.title)}</strong><div style="font-size:.78rem;color:var(--text2);margin-top:2px;">${esc((a.content||'').substring(0,60))}‚Ä¶</div></td>
        <td><span class="badge ${bm[a.type]||'bg-blue'}">${a.type}</span></td>
        <td style="color:var(--text2);font-size:.82rem;">${fmtDate(a.created_at)}</td>
        <td><button class="act-btn btn-del" onclick="delAnn('${a.id}')">üóë Delete</button></td>
    </tr>`).join('');
}

async function sendAnnouncement() {
    const title   = document.getElementById('annTitle').value.trim();
    const content = document.getElementById('annContent').value.trim();
    const type    = document.getElementById('annType').value;
    const target  = document.getElementById('annTarget').value;
    const priority= document.getElementById('annPriority').value;
    if (!title||!content){toast('Title and message required!','error');return;}

    const { error } = await sb.from('announcements')
        .insert({title,content,type,target,priority,created_by:currentAdmin.id})
        .catch(e=>({error:e}));

    if (error) {
        toast('Note: Create "announcements" table in Supabase first (see README).','info');
    } else {
        toast('üì¢ Announcement published!','success');
        document.getElementById('annTitle').value='';
        document.getElementById('annContent').value='';
        loadAnnouncements();
    }
}

async function delAnn(id) {
    await sb.from('announcements').delete().eq('id',id);
    toast('üóë Deleted','info');
    loadAnnouncements();
}

// ===== LOGS =====
async function loadLogs() {
    const {data} = await sb.from('user_data').select('user_id,data,updated_at').order('updated_at',{ascending:false}).limit(150);
    const el = document.getElementById('logList');
    const filter = document.getElementById('logFilter')?.value;
    let rows = data||[];
    if (filter==='recent') {
        const cutoff = new Date(Date.now()-864e5).toISOString();
        rows = rows.filter(u=>u.updated_at>cutoff);
    }
    if (!rows.length){el.innerHTML='<div class="empty-state"><div class="ei">üìã</div><h3>No logs</h3></div>';return;}
    el.innerHTML = rows.map(u=>`<div class="act-item">
        <div class="act-dot" style="background:var(--green)"></div>
        <div><div class="act-text"><strong>${esc(u.data?.social?.name||'User')}</strong> ‚Äî data saved</div>
        <div class="act-time">${new Date(u.updated_at).toLocaleString('en-US')} ¬∑ ${u.user_id.substring(0,8)}‚Ä¶</div></div>
    </div>`).join('');
}

// ===== SETTINGS =====
async function checkSupabase() {
    try {
        const {error} = await sb.from('user_data').select('user_id').limit(1);
        const el = document.getElementById('supaStatus');
        if (error) { el.className='badge bg-yellow'; el.textContent='‚ö†Ô∏è Limited'; }
        else        { el.className='badge bg-green';  el.textContent='‚úÖ Connected'; }

        const {count} = await sb.from('user_data').select('*',{count:'exact',head:true});
        document.getElementById('supaStats').innerHTML = `Total rows: <strong>${count||0}</strong><br>URL: <span class="mono" style="font-size:.75rem;">${SUPABASE_URL.substring(0,40)}‚Ä¶</span>`;
    } catch(e) {
        document.getElementById('supaStatus').textContent='‚ùå Error';
    }
}

function changePassword() {
    const p1=document.getElementById('newPw').value;
    const p2=document.getElementById('confirmPw').value;
    if (!p1||!p2){toast('Fill both fields','error');return;}
    if (p1!==p2){toast('Passwords do not match','error');return;}
    sb.auth.updateUser({password:p1}).then(({error})=>{
        if (error) toast('Error: '+error.message,'error');
        else { toast('‚úÖ Password updated','success'); document.getElementById('newPw').value=''; document.getElementById('confirmPw').value=''; }
    });
}

// ===== CHARTS =====
const CHART_DEFAULTS = { responsive:true, plugins:{legend:{labels:{color:'#8892a4',font:{size:11}}}}, scales:{x:{grid:{color:'rgba(255,255,255,.05)'},ticks:{color:'#8892a4'}}, y:{grid:{color:'rgba(255,255,255,.05)'},ticks:{color:'#8892a4'}}} };

function drawLineChart(id, {labels,data}) {
    if (charts[id]) charts[id].destroy();
    charts[id] = new Chart(document.getElementById(id).getContext('2d'), {
        type:'line',
        data:{ labels, datasets:[{label:'Active',data,borderColor:'#ff3366',backgroundColor:'rgba(255,51,102,.1)',tension:.4,fill:true,pointBackgroundColor:'#ff3366',pointRadius:4}] },
        options:{...CHART_DEFAULTS, plugins:{legend:{display:false}}}
    });
}

function drawDonut(id, labels, data, colors) {
    if (charts[id]) charts[id].destroy();
    charts[id] = new Chart(document.getElementById(id).getContext('2d'), {
        type:'doughnut',
        data:{labels,datasets:[{data,backgroundColor:colors,borderWidth:0}]},
        options:{responsive:true,cutout:'65%',plugins:{legend:{labels:{color:'#8892a4',padding:14,font:{size:11}}}}}
    });
}

function drawBar(id, labels, data) {
    if (charts[id]) charts[id].destroy();
    charts[id] = new Chart(document.getElementById(id).getContext('2d'), {
        type:'bar',
        data:{labels,datasets:[{data,backgroundColor:'rgba(255,51,102,.7)',borderRadius:6}]},
        options:{...CHART_DEFAULTS,plugins:{legend:{display:false}}}
    });
}

// ===== MODALS =====
function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
function openConfirm(title,text,cb){
    document.getElementById('confirmTitle').textContent=title;
    document.getElementById('confirmText').textContent=text;
    document.getElementById('confirmBtn').onclick=()=>{closeModal('confirmModal');cb();};
    openModal('confirmModal');
}
function closeConfirm(){closeModal('confirmModal');}

// ===== PAGINATION =====
function renderPag(id, pages, cur, onClick) {
    const el=document.getElementById(id);
    if (!el||pages<=1){if(el)el.innerHTML='';return;}
    el.innerHTML=Array.from({length:Math.min(pages,7)},(_,i)=>{
        const p=i+1;
        return `<button class="pag-btn${p===cur?' active':''}" onclick="(${onClick.toString()})(${p})">${p}</button>`;
    }).join('');
}

// ===== TOAST =====
function toast(msg, type='info') {
    const icons={success:'‚úÖ',error:'‚ùå',info:'‚ÑπÔ∏è'};
    const el=document.createElement('div');
    el.className=`toast ${type}`;
    el.innerHTML=`<span>${icons[type]||'‚Ä¢'}</span>${msg}`;
    document.getElementById('toast').appendChild(el);
    setTimeout(()=>el.remove(), 4500);
}

// ===== UTILS =====
function fmtDate(s){return s?new Date(s).toLocaleDateString('en-US'):'‚Äî';}
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
</script>

    <!-- ===== BAN MODAL ===== -->
    <div class="ban-modal-overlay" id="banModalOverlay" onclick="closeBanModal(event)">
        <div class="ban-modal">
            <div class="ban-modal-header">
                <div class="ban-modal-title">üö´ Kullanƒ±cƒ±yƒ± Banla</div>
                <button class="ban-modal-close" onclick="closeBanModal()">‚úï</button>
            </div>

            <!-- User info -->
            <div class="ban-user-card">
                <div class="ban-user-av">üë§</div>
                <div>
                    <div class="ban-user-name" id="banTargetName">Kullanƒ±cƒ±</div>
                    <div class="ban-user-sub" id="banTargetId">‚Äî</div>
                </div>
            </div>

            <!-- Quick reason chips -->
            <div class="ban-field">
                <label>‚ö° Hƒ±zlƒ± Sebep Se√ß</label>
                <div class="ban-reason-chips">
                    <span class="ban-chip" onclick="selectChip(this, 'Spam / Reklam')">üîÅ Spam</span>
                    <span class="ban-chip" onclick="selectChip(this, 'Uygunsuz i√ßerik')">üîû Uygunsuz ƒ∞√ßerik</span>
                    <span class="ban-chip" onclick="selectChip(this, 'Hakaret / K√ºf√ºr')">ü§¨ Hakaret</span>
                    <span class="ban-chip" onclick="selectChip(this, 'Sahte hesap')">üé≠ Sahte Hesap</span>
                    <span class="ban-chip" onclick="selectChip(this, 'Kural ihlali')">‚ö†Ô∏è Kural ƒ∞hlali</span>
                </div>
            </div>

            <!-- Custom reason -->
            <div class="ban-field">
                <label>üìù Ban Sebebi</label>
                <textarea id="banReasonInput" rows="3" placeholder="Ban sebebini a√ßƒ±klayƒ±n..."></textarea>
            </div>

            <!-- Duration -->
            <div class="ban-field">
                <label>‚è±Ô∏è Ban S√ºresi</label>
                <select id="banDuration">
                    <option value="permanent">‚ôæÔ∏è Kalƒ±cƒ± Ban</option>
                    <option value="7">üìÖ 7 G√ºn</option>
                    <option value="30">üìÖ 30 G√ºn</option>
                    <option value="90">üìÖ 90 G√ºn</option>
                </select>
            </div>

            <div class="ban-modal-actions">
                <button class="btn-ban-cancel" onclick="closeBanModal()">ƒ∞ptal</button>
                <button class="btn-ban-confirm" onclick="executeBan()">üö´ Banla</button>
            </div>
        </div>
    </div>

</body>
</html>